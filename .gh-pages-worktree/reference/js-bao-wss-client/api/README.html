<!DOCTYPE html>
<html lang="en-US" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>JsBao Client Library | Primitive Docs</title>
    <meta name="description" content="Unified documentation for Primitive Labs libraries and apps.">
    <meta name="generator" content="VitePress v2.0.0-alpha.15">
    <link rel="preload stylesheet" href="/primitive-docs/assets/style.tJDdAgbl.css" as="style">
    <link rel="preload stylesheet" href="/primitive-docs/vp-icons.css" as="style">
    
    <script type="module" src="/primitive-docs/assets/app.BnWB_wus.js"></script>
    <link rel="preload" href="/primitive-docs/assets/inter-roman-latin.Di8DUHzh.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/primitive-docs/assets/chunks/theme.Bh4Y5foJ.js">
    <link rel="modulepreload" href="/primitive-docs/assets/chunks/framework.HLg5PcC2.js">
    <link rel="modulepreload" href="/primitive-docs/assets/reference_js-bao-wss-client_api_README.md.ChRTWbJP.lean.js">
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-b0764d2a><!--[--><!--]--><!--[--><span tabindex="-1" data-v-5d1f9f48></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-5d1f9f48>Skip to content</a><!--]--><!----><header class="VPNav" data-v-b0764d2a data-v-6119ff33><div class="VPNavBar" data-v-6119ff33 data-v-2dbb9713><div class="wrapper" data-v-2dbb9713><div class="container" data-v-2dbb9713><div class="title" data-v-2dbb9713><div class="VPNavBarTitle has-sidebar" data-v-2dbb9713 data-v-5e82587f><a class="title" href="/primitive-docs/" data-v-5e82587f><!--[--><!--]--><!----><span data-v-5e82587f>Primitive Docs</span><!--[--><!--]--></a></div></div><div class="content" data-v-2dbb9713><div class="content-body" data-v-2dbb9713><!--[--><!--]--><div class="VPNavBarSearch search" data-v-2dbb9713><!--[--><!----><div id="local-search"><button type="button" aria-label="Search" aria-keyshortcuts="/ control+k meta+k" class="DocSearch DocSearch-Button"><span class="DocSearch-Button-Container"><span class="vpi-search DocSearch-Search-Icon"></span><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"></kbd><kbd class="DocSearch-Button-Key"></kbd></span></button></div><!--]--></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-2dbb9713 data-v-d518d07c><span id="main-nav-aria-label" class="visually-hidden" data-v-d518d07c> Main Navigation </span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/primitive-docs/" tabindex="0" data-v-d518d07c data-v-9433881f><!--[--><span data-v-9433881f>Docs</span><!--]--></a><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-2dbb9713 data-v-bc571f04><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-bc571f04 data-v-4d1c2753 data-v-b3c2a5b8><span class="check" data-v-b3c2a5b8><span class="icon" data-v-b3c2a5b8><!--[--><span class="vpi-sun sun" data-v-4d1c2753></span><span class="vpi-moon moon" data-v-4d1c2753></span><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-2dbb9713 data-v-60837f6f data-v-2f8524cd><!--[--><a class="VPSocialLink no-icon" href="https://github.com/Primitive-Labs/primitive-docs" aria-label="github" target="_blank" rel="me noopener" data-v-2f8524cd data-v-ccbf95f3><span class="vpi-social-github"></span></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-2dbb9713 data-v-67e8dfe6 data-v-63f513c2><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-63f513c2><span class="vpi-more-horizontal icon" data-v-63f513c2></span></button><div class="menu" data-v-63f513c2><div class="VPMenu" data-v-63f513c2 data-v-0315ab04><!----><!--[--><!--[--><!----><div class="group" data-v-67e8dfe6><div class="item appearance" data-v-67e8dfe6><p class="label" data-v-67e8dfe6>Appearance</p><div class="appearance-action" data-v-67e8dfe6><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-67e8dfe6 data-v-4d1c2753 data-v-b3c2a5b8><span class="check" data-v-b3c2a5b8><span class="icon" data-v-b3c2a5b8><!--[--><span class="vpi-sun sun" data-v-4d1c2753></span><span class="vpi-moon moon" data-v-4d1c2753></span><!--]--></span></span></button></div></div></div><div class="group" data-v-67e8dfe6><div class="item social-links" data-v-67e8dfe6><div class="VPSocialLinks social-links-list" data-v-67e8dfe6 data-v-2f8524cd><!--[--><a class="VPSocialLink no-icon" href="https://github.com/Primitive-Labs/primitive-docs" aria-label="github" target="_blank" rel="me noopener" data-v-2f8524cd data-v-ccbf95f3><span class="vpi-social-github"></span></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-2dbb9713 data-v-89f60fe8><span class="container" data-v-89f60fe8><span class="top" data-v-89f60fe8></span><span class="middle" data-v-89f60fe8></span><span class="bottom" data-v-89f60fe8></span></span></button></div></div></div></div><div class="divider" data-v-2dbb9713><div class="divider-line" data-v-2dbb9713></div></div></div><!----></header><div class="VPLocalNav has-sidebar empty" data-v-b0764d2a data-v-e15f588a><div class="container" data-v-e15f588a><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-e15f588a><span class="vpi-align-left menu-icon" data-v-e15f588a></span><span class="menu-text" data-v-e15f588a>Menu</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-e15f588a data-v-760341c1><button data-v-760341c1>Return to top</button><!----></div></div></div><aside class="VPSidebar" data-v-b0764d2a data-v-6b9216e1><div class="curtain" data-v-6b9216e1></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-6b9216e1><span class="visually-hidden" id="sidebar-aria-label" data-v-6b9216e1> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="no-transition group" data-v-821bb7df><section class="VPSidebarItem level-0 collapsible" data-v-821bb7df data-v-653fc4a4><div class="item" role="button" tabindex="0" data-v-653fc4a4><div class="indicator" data-v-653fc4a4></div><h2 class="text" data-v-653fc4a4>Getting Started</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-653fc4a4><span class="vpi-chevron-right caret-icon" data-v-653fc4a4></span></div></div><div class="items" data-v-653fc4a4><!--[--><div class="VPSidebarItem level-1 is-link" data-v-653fc4a4 data-v-653fc4a4><div class="item" data-v-653fc4a4><div class="indicator" data-v-653fc4a4></div><a class="VPLink link link" href="/primitive-docs/getting-started/page-1.html" data-v-653fc4a4><!--[--><p class="text" data-v-653fc4a4>Page 1</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-653fc4a4 data-v-653fc4a4><div class="item" data-v-653fc4a4><div class="indicator" data-v-653fc4a4></div><a class="VPLink link link" href="/primitive-docs/getting-started/page-2.html" data-v-653fc4a4><!--[--><p class="text" data-v-653fc4a4>Page 2</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-821bb7df><section class="VPSidebarItem level-0 collapsible collapsed" data-v-821bb7df data-v-653fc4a4><div class="item" role="button" tabindex="0" data-v-653fc4a4><div class="indicator" data-v-653fc4a4></div><h2 class="text" data-v-653fc4a4>Reference</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-653fc4a4><span class="vpi-chevron-right caret-icon" data-v-653fc4a4></span></div></div><div class="items" data-v-653fc4a4><!--[--><section class="VPSidebarItem level-1 collapsible collapsed" data-v-653fc4a4 data-v-653fc4a4><div class="item" role="button" tabindex="0" data-v-653fc4a4><div class="indicator" data-v-653fc4a4></div><h3 class="text" data-v-653fc4a4>primitive-app</h3><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-653fc4a4><span class="vpi-chevron-right caret-icon" data-v-653fc4a4></span></div></div><div class="items" data-v-653fc4a4><!--[--><div class="VPSidebarItem level-2 is-link" data-v-653fc4a4 data-v-653fc4a4><div class="item" data-v-653fc4a4><div class="indicator" data-v-653fc4a4></div><a class="VPLink link link" href="/primitive-docs/reference/primitive-app/createPrimitiveApp.html" data-v-653fc4a4><!--[--><p class="text" data-v-653fc4a4>createPrimitiveApp</p><!--]--></a><!----></div><!----></div><section class="VPSidebarItem level-2 collapsible collapsed" data-v-653fc4a4 data-v-653fc4a4><div class="item" role="button" tabindex="0" data-v-653fc4a4><div class="indicator" data-v-653fc4a4></div><h4 class="text" data-v-653fc4a4>Components</h4><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-653fc4a4><span class="vpi-chevron-right caret-icon" data-v-653fc4a4></span></div></div><div class="items" data-v-653fc4a4><!--[--><section class="VPSidebarItem level-3" data-v-653fc4a4 data-v-653fc4a4><div class="item" role="button" tabindex="0" data-v-653fc4a4><div class="indicator" data-v-653fc4a4></div><h5 class="text" data-v-653fc4a4>Auth</h5><!----></div><div class="items" data-v-653fc4a4><!--[--><div class="VPSidebarItem level-4 is-link" data-v-653fc4a4 data-v-653fc4a4><div class="item" data-v-653fc4a4><div class="indicator" data-v-653fc4a4></div><a class="VPLink link link" href="/primitive-docs/reference/primitive-app/components/components/auth/PrimitiveLogin.html" data-v-653fc4a4><!--[--><p class="text" data-v-653fc4a4>PrimitiveLogin</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-4 is-link" data-v-653fc4a4 data-v-653fc4a4><div class="item" data-v-653fc4a4><div class="indicator" data-v-653fc4a4></div><a class="VPLink link link" href="/primitive-docs/reference/primitive-app/components/components/auth/PrimitiveLogout.html" data-v-653fc4a4><!--[--><p class="text" data-v-653fc4a4>PrimitiveLogout</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-4 is-link" data-v-653fc4a4 data-v-653fc4a4><div class="item" data-v-653fc4a4><div class="indicator" data-v-653fc4a4></div><a class="VPLink link link" href="/primitive-docs/reference/primitive-app/components/components/auth/PrimitiveOauthCallback.html" data-v-653fc4a4><!--[--><p class="text" data-v-653fc4a4>PrimitiveOauthCallback</p><!--]--></a><!----></div><!----></div><!--]--></div></section><section class="VPSidebarItem level-3" data-v-653fc4a4 data-v-653fc4a4><div class="item" role="button" tabindex="0" data-v-653fc4a4><div class="indicator" data-v-653fc4a4></div><h5 class="text" data-v-653fc4a4>Documents</h5><!----></div><div class="items" data-v-653fc4a4><!--[--><div class="VPSidebarItem level-4 is-link" data-v-653fc4a4 data-v-653fc4a4><div class="item" data-v-653fc4a4><div class="indicator" data-v-653fc4a4></div><a class="VPLink link link" href="/primitive-docs/reference/primitive-app/components/components/documents/PrimitiveManageDocuments.html" data-v-653fc4a4><!--[--><p class="text" data-v-653fc4a4>PrimitiveManageDocuments</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-4 is-link" data-v-653fc4a4 data-v-653fc4a4><div class="item" data-v-653fc4a4><div class="indicator" data-v-653fc4a4></div><a class="VPLink link link" href="/primitive-docs/reference/primitive-app/components/components/documents/PrimitiveShareDocumentDialog.html" data-v-653fc4a4><!--[--><p class="text" data-v-653fc4a4>PrimitiveShareDocumentDialog</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-4 is-link" data-v-653fc4a4 data-v-653fc4a4><div class="item" data-v-653fc4a4><div class="indicator" data-v-653fc4a4></div><a class="VPLink link link" href="/primitive-docs/reference/primitive-app/components/components/documents/PrimitiveSingleDocumentSwitcher.html" data-v-653fc4a4><!--[--><p class="text" data-v-653fc4a4>PrimitiveSingleDocumentSwitcher</p><!--]--></a><!----></div><!----></div><!--]--></div></section><section class="VPSidebarItem level-3" data-v-653fc4a4 data-v-653fc4a4><div class="item" role="button" tabindex="0" data-v-653fc4a4><div class="indicator" data-v-653fc4a4></div><h5 class="text" data-v-653fc4a4>Navigation</h5><!----></div><div class="items" data-v-653fc4a4><!--[--><div class="VPSidebarItem level-4 is-link" data-v-653fc4a4 data-v-653fc4a4><div class="item" data-v-653fc4a4><div class="indicator" data-v-653fc4a4></div><a class="VPLink link link" href="/primitive-docs/reference/primitive-app/components/components/navigation/PrimitiveAppBreadcrumb.html" data-v-653fc4a4><!--[--><p class="text" data-v-653fc4a4>PrimitiveAppBreadcrumb</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-4 is-link" data-v-653fc4a4 data-v-653fc4a4><div class="item" data-v-653fc4a4><div class="indicator" data-v-653fc4a4></div><a class="VPLink link link" href="/primitive-docs/reference/primitive-app/components/components/navigation/PrimitiveAppSidebarHeader.html" data-v-653fc4a4><!--[--><p class="text" data-v-653fc4a4>PrimitiveAppSidebarHeader</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-4 is-link" data-v-653fc4a4 data-v-653fc4a4><div class="item" data-v-653fc4a4><div class="indicator" data-v-653fc4a4></div><a class="VPLink link link" href="/primitive-docs/reference/primitive-app/components/components/navigation/PrimitiveBottomNav.html" data-v-653fc4a4><!--[--><p class="text" data-v-653fc4a4>PrimitiveBottomNav</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-4 is-link" data-v-653fc4a4 data-v-653fc4a4><div class="item" data-v-653fc4a4><div class="indicator" data-v-653fc4a4></div><a class="VPLink link link" href="/primitive-docs/reference/primitive-app/components/components/navigation/PrimitiveNavigationBadge.html" data-v-653fc4a4><!--[--><p class="text" data-v-653fc4a4>PrimitiveNavigationBadge</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-4 is-link" data-v-653fc4a4 data-v-653fc4a4><div class="item" data-v-653fc4a4><div class="indicator" data-v-653fc4a4></div><a class="VPLink link link" href="/primitive-docs/reference/primitive-app/components/components/navigation/PrimitiveSidebarNav.html" data-v-653fc4a4><!--[--><p class="text" data-v-653fc4a4>PrimitiveSidebarNav</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-4 is-link" data-v-653fc4a4 data-v-653fc4a4><div class="item" data-v-653fc4a4><div class="indicator" data-v-653fc4a4></div><a class="VPLink link link" href="/primitive-docs/reference/primitive-app/components/components/navigation/PrimitiveUserMenu.html" data-v-653fc4a4><!--[--><p class="text" data-v-653fc4a4>PrimitiveUserMenu</p><!--]--></a><!----></div><!----></div><!--]--></div></section><section class="VPSidebarItem level-3" data-v-653fc4a4 data-v-653fc4a4><div class="item" role="button" tabindex="0" data-v-653fc4a4><div class="indicator" data-v-653fc4a4></div><h5 class="text" data-v-653fc4a4>Shared</h5><!----></div><div class="items" data-v-653fc4a4><!--[--><div class="VPSidebarItem level-4 is-link" data-v-653fc4a4 data-v-653fc4a4><div class="item" data-v-653fc4a4><div class="indicator" data-v-653fc4a4></div><a class="VPLink link link" href="/primitive-docs/reference/primitive-app/components/components/shared/DeleteConfirmationDialog.html" data-v-653fc4a4><!--[--><p class="text" data-v-653fc4a4>DeleteConfirmationDialog</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-4 is-link" data-v-653fc4a4 data-v-653fc4a4><div class="item" data-v-653fc4a4><div class="indicator" data-v-653fc4a4></div><a class="VPLink link link" href="/primitive-docs/reference/primitive-app/components/components/shared/PrimitiveLogoSpinner.html" data-v-653fc4a4><!--[--><p class="text" data-v-653fc4a4>PrimitiveLogoSpinner</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-4 is-link" data-v-653fc4a4 data-v-653fc4a4><div class="item" data-v-653fc4a4><div class="indicator" data-v-653fc4a4></div><a class="VPLink link link" href="/primitive-docs/reference/primitive-app/components/components/shared/PrimitiveSkeletonGate.html" data-v-653fc4a4><!--[--><p class="text" data-v-653fc4a4>PrimitiveSkeletonGate</p><!--]--></a><!----></div><!----></div><!--]--></div></section><!--]--></div></section><section class="VPSidebarItem level-2 collapsible collapsed" data-v-653fc4a4 data-v-653fc4a4><div class="item" role="button" tabindex="0" data-v-653fc4a4><div class="indicator" data-v-653fc4a4></div><h4 class="text" data-v-653fc4a4>Layouts</h4><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-653fc4a4><span class="vpi-chevron-right caret-icon" data-v-653fc4a4></span></div></div><div class="items" data-v-653fc4a4><!--[--><div class="VPSidebarItem level-3 is-link" data-v-653fc4a4 data-v-653fc4a4><div class="item" data-v-653fc4a4><div class="indicator" data-v-653fc4a4></div><a class="VPLink link link" href="/primitive-docs/reference/primitive-app/components/layouts/PrimitiveAppLayout.html" data-v-653fc4a4><!--[--><p class="text" data-v-653fc4a4>PrimitiveAppLayout</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-3 is-link" data-v-653fc4a4 data-v-653fc4a4><div class="item" data-v-653fc4a4><div class="indicator" data-v-653fc4a4></div><a class="VPLink link link" href="/primitive-docs/reference/primitive-app/components/layouts/PrimitiveLoginLayout.html" data-v-653fc4a4><!--[--><p class="text" data-v-653fc4a4>PrimitiveLoginLayout</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-3 is-link" data-v-653fc4a4 data-v-653fc4a4><div class="item" data-v-653fc4a4><div class="indicator" data-v-653fc4a4></div><a class="VPLink link link" href="/primitive-docs/reference/primitive-app/components/layouts/PrimitiveStaticLayout.html" data-v-653fc4a4><!--[--><p class="text" data-v-653fc4a4>PrimitiveStaticLayout</p><!--]--></a><!----></div><!----></div><!--]--></div></section><section class="VPSidebarItem level-2 collapsible collapsed" data-v-653fc4a4 data-v-653fc4a4><div class="item" role="button" tabindex="0" data-v-653fc4a4><div class="indicator" data-v-653fc4a4></div><h4 class="text" data-v-653fc4a4>Pages</h4><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-653fc4a4><span class="vpi-chevron-right caret-icon" data-v-653fc4a4></span></div></div><div class="items" data-v-653fc4a4><!--[--><div class="VPSidebarItem level-3 is-link" data-v-653fc4a4 data-v-653fc4a4><div class="item" data-v-653fc4a4><div class="indicator" data-v-653fc4a4></div><a class="VPLink link link" href="/primitive-docs/reference/primitive-app/components/pages/PrimitiveNotFound.html" data-v-653fc4a4><!--[--><p class="text" data-v-653fc4a4>PrimitiveNotFound</p><!--]--></a><!----></div><!----></div><!--]--></div></section><section class="VPSidebarItem level-2 collapsible collapsed" data-v-653fc4a4 data-v-653fc4a4><div class="item" role="button" tabindex="0" data-v-653fc4a4><div class="indicator" data-v-653fc4a4></div><h4 class="text" data-v-653fc4a4>Utils</h4><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-653fc4a4><span class="vpi-chevron-right caret-icon" data-v-653fc4a4></span></div></div><div class="items" data-v-653fc4a4><!--[--><div class="VPSidebarItem level-3 is-link" data-v-653fc4a4 data-v-653fc4a4><div class="item" data-v-653fc4a4><div class="indicator" data-v-653fc4a4></div><a class="VPLink link link" href="/primitive-docs/reference/primitive-app/utils/Logger.html" data-v-653fc4a4><!--[--><p class="text" data-v-653fc4a4>Logger</p><!--]--></a><!----></div><!----></div><!--]--></div></section><section class="VPSidebarItem level-2 collapsible collapsed" data-v-653fc4a4 data-v-653fc4a4><div class="item" role="button" tabindex="0" data-v-653fc4a4><div class="indicator" data-v-653fc4a4></div><h4 class="text" data-v-653fc4a4>Composables</h4><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-653fc4a4><span class="vpi-chevron-right caret-icon" data-v-653fc4a4></span></div></div><div class="items" data-v-653fc4a4><!--[--><div class="VPSidebarItem level-3 is-link" data-v-653fc4a4 data-v-653fc4a4><div class="item" data-v-653fc4a4><div class="indicator" data-v-653fc4a4></div><a class="VPLink link link" href="/primitive-docs/reference/primitive-app/composables/useJsBaoDataLoader.html" data-v-653fc4a4><!--[--><p class="text" data-v-653fc4a4>useJsBaoDataLoader</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-3 is-link" data-v-653fc4a4 data-v-653fc4a4><div class="item" data-v-653fc4a4><div class="indicator" data-v-653fc4a4></div><a class="VPLink link link" href="/primitive-docs/reference/primitive-app/composables/useTheme.html" data-v-653fc4a4><!--[--><p class="text" data-v-653fc4a4>useTheme</p><!--]--></a><!----></div><!----></div><!--]--></div></section><section class="VPSidebarItem level-2 collapsible collapsed" data-v-653fc4a4 data-v-653fc4a4><div class="item" role="button" tabindex="0" data-v-653fc4a4><div class="indicator" data-v-653fc4a4></div><h4 class="text" data-v-653fc4a4>Config</h4><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-653fc4a4><span class="vpi-chevron-right caret-icon" data-v-653fc4a4></span></div></div><div class="items" data-v-653fc4a4><!--[--><div class="VPSidebarItem level-3 is-link" data-v-653fc4a4 data-v-653fc4a4><div class="item" data-v-653fc4a4><div class="indicator" data-v-653fc4a4></div><a class="VPLink link link" href="/primitive-docs/reference/primitive-app/config/app-config.html" data-v-653fc4a4><!--[--><p class="text" data-v-653fc4a4>app-config</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-3 is-link" data-v-653fc4a4 data-v-653fc4a4><div class="item" data-v-653fc4a4><div class="indicator" data-v-653fc4a4></div><a class="VPLink link link" href="/primitive-docs/reference/primitive-app/config/env-config.html" data-v-653fc4a4><!--[--><p class="text" data-v-653fc4a4>env-config</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-3 is-link" data-v-653fc4a4 data-v-653fc4a4><div class="item" data-v-653fc4a4><div class="indicator" data-v-653fc4a4></div><a class="VPLink link link" href="/primitive-docs/reference/primitive-app/config/index.html" data-v-653fc4a4><!--[--><p class="text" data-v-653fc4a4>index</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-3 is-link" data-v-653fc4a4 data-v-653fc4a4><div class="item" data-v-653fc4a4><div class="indicator" data-v-653fc4a4></div><a class="VPLink link link" href="/primitive-docs/reference/primitive-app/config/navigation-config.html" data-v-653fc4a4><!--[--><p class="text" data-v-653fc4a4>navigation-config</p><!--]--></a><!----></div><!----></div><!--]--></div></section><!--]--></div></section><section class="VPSidebarItem level-1 collapsible collapsed" data-v-653fc4a4 data-v-653fc4a4><div class="item" role="button" tabindex="0" data-v-653fc4a4><div class="indicator" data-v-653fc4a4></div><h3 class="text" data-v-653fc4a4>js-bao-wss-client</h3><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-653fc4a4><span class="vpi-chevron-right caret-icon" data-v-653fc4a4></span></div></div><div class="items" data-v-653fc4a4><!--[--><section class="VPSidebarItem level-2 collapsible collapsed" data-v-653fc4a4 data-v-653fc4a4><div class="item" role="button" tabindex="0" data-v-653fc4a4><div class="indicator" data-v-653fc4a4></div><h4 class="text" data-v-653fc4a4>Classes</h4><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-653fc4a4><span class="vpi-chevron-right caret-icon" data-v-653fc4a4></span></div></div><div class="items" data-v-653fc4a4><!--[--><div class="VPSidebarItem level-3 is-link" data-v-653fc4a4 data-v-653fc4a4><div class="item" data-v-653fc4a4><div class="indicator" data-v-653fc4a4></div><a class="VPLink link link" href="/primitive-docs/reference/js-bao-wss-client/api/classes/JsBaoClient.html" data-v-653fc4a4><!--[--><p class="text" data-v-653fc4a4>JsBaoClient</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-3 is-link" data-v-653fc4a4 data-v-653fc4a4><div class="item" data-v-653fc4a4><div class="indicator" data-v-653fc4a4></div><a class="VPLink link link" href="/primitive-docs/reference/js-bao-wss-client/api/classes/JsBaoError.html" data-v-653fc4a4><!--[--><p class="text" data-v-653fc4a4>JsBaoError</p><!--]--></a><!----></div><!----></div><!--]--></div></section><section class="VPSidebarItem level-2 collapsible collapsed" data-v-653fc4a4 data-v-653fc4a4><div class="item" role="button" tabindex="0" data-v-653fc4a4><div class="indicator" data-v-653fc4a4></div><h4 class="text" data-v-653fc4a4>Functions</h4><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-653fc4a4><span class="vpi-chevron-right caret-icon" data-v-653fc4a4></span></div></div><div class="items" data-v-653fc4a4><!--[--><div class="VPSidebarItem level-3 is-link" data-v-653fc4a4 data-v-653fc4a4><div class="item" data-v-653fc4a4><div class="indicator" data-v-653fc4a4></div><a class="VPLink link link" href="/primitive-docs/reference/js-bao-wss-client/api/functions/initializeClient.html" data-v-653fc4a4><!--[--><p class="text" data-v-653fc4a4>initializeClient</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-3 is-link" data-v-653fc4a4 data-v-653fc4a4><div class="item" data-v-653fc4a4><div class="indicator" data-v-653fc4a4></div><a class="VPLink link link" href="/primitive-docs/reference/js-bao-wss-client/api/functions/isJsBaoError.html" data-v-653fc4a4><!--[--><p class="text" data-v-653fc4a4>isJsBaoError</p><!--]--></a><!----></div><!----></div><!--]--></div></section><section class="VPSidebarItem level-2 collapsible collapsed" data-v-653fc4a4 data-v-653fc4a4><div class="item" role="button" tabindex="0" data-v-653fc4a4><div class="indicator" data-v-653fc4a4></div><h4 class="text" data-v-653fc4a4>Interfaces</h4><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-653fc4a4><span class="vpi-chevron-right caret-icon" data-v-653fc4a4></span></div></div><div class="items" data-v-653fc4a4><!--[--><div class="VPSidebarItem level-3 is-link" data-v-653fc4a4 data-v-653fc4a4><div class="item" data-v-653fc4a4><div class="indicator" data-v-653fc4a4></div><a class="VPLink link link" href="/primitive-docs/reference/js-bao-wss-client/api/interfaces/AnalyticsAutoEventsOptions.html" data-v-653fc4a4><!--[--><p class="text" data-v-653fc4a4>AnalyticsAutoEventsOptions</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-3 is-link" data-v-653fc4a4 data-v-653fc4a4><div class="item" data-v-653fc4a4><div class="indicator" data-v-653fc4a4></div><a class="VPLink link link" href="/primitive-docs/reference/js-bao-wss-client/api/interfaces/AnalyticsClient.html" data-v-653fc4a4><!--[--><p class="text" data-v-653fc4a4>AnalyticsClient</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-3 is-link" data-v-653fc4a4 data-v-653fc4a4><div class="item" data-v-653fc4a4><div class="indicator" data-v-653fc4a4></div><a class="VPLink link link" href="/primitive-docs/reference/js-bao-wss-client/api/interfaces/AnalyticsEventInput.html" data-v-653fc4a4><!--[--><p class="text" data-v-653fc4a4>AnalyticsEventInput</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-3 is-link" data-v-653fc4a4 data-v-653fc4a4><div class="item" data-v-653fc4a4><div class="indicator" data-v-653fc4a4></div><a class="VPLink link link" href="/primitive-docs/reference/js-bao-wss-client/api/interfaces/AuthStateEvent.html" data-v-653fc4a4><!--[--><p class="text" data-v-653fc4a4>AuthStateEvent</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-3 is-link" data-v-653fc4a4 data-v-653fc4a4><div class="item" data-v-653fc4a4><div class="indicator" data-v-653fc4a4></div><a class="VPLink link link" href="/primitive-docs/reference/js-bao-wss-client/api/interfaces/BasicUserInfo.html" data-v-653fc4a4><!--[--><p class="text" data-v-653fc4a4>BasicUserInfo</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-3 is-link" data-v-653fc4a4 data-v-653fc4a4><div class="item" data-v-653fc4a4><div class="indicator" data-v-653fc4a4></div><a class="VPLink link link" href="/primitive-docs/reference/js-bao-wss-client/api/interfaces/BlobUploadCompletedEvent.html" data-v-653fc4a4><!--[--><p class="text" data-v-653fc4a4>BlobUploadCompletedEvent</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-3 is-link" data-v-653fc4a4 data-v-653fc4a4><div class="item" data-v-653fc4a4><div class="indicator" data-v-653fc4a4></div><a class="VPLink link link" href="/primitive-docs/reference/js-bao-wss-client/api/interfaces/BlobUploadFailedEvent.html" data-v-653fc4a4><!--[--><p class="text" data-v-653fc4a4>BlobUploadFailedEvent</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-3 is-link" data-v-653fc4a4 data-v-653fc4a4><div class="item" data-v-653fc4a4><div class="indicator" data-v-653fc4a4></div><a class="VPLink link link" href="/primitive-docs/reference/js-bao-wss-client/api/interfaces/BlobUploadProgressEvent.html" data-v-653fc4a4><!--[--><p class="text" data-v-653fc4a4>BlobUploadProgressEvent</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-3 is-link" data-v-653fc4a4 data-v-653fc4a4><div class="item" data-v-653fc4a4><div class="indicator" data-v-653fc4a4></div><a class="VPLink link link" href="/primitive-docs/reference/js-bao-wss-client/api/interfaces/CacheFacade.html" data-v-653fc4a4><!--[--><p class="text" data-v-653fc4a4>CacheFacade</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-3 is-link" data-v-653fc4a4 data-v-653fc4a4><div class="item" data-v-653fc4a4><div class="indicator" data-v-653fc4a4></div><a class="VPLink link link" href="/primitive-docs/reference/js-bao-wss-client/api/interfaces/DocumentAccessResult.html" data-v-653fc4a4><!--[--><p class="text" data-v-653fc4a4>DocumentAccessResult</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-3 is-link" data-v-653fc4a4 data-v-653fc4a4><div class="item" data-v-653fc4a4><div class="indicator" data-v-653fc4a4></div><a class="VPLink link link" href="/primitive-docs/reference/js-bao-wss-client/api/interfaces/DocumentCreateCommitFailedEvent.html" data-v-653fc4a4><!--[--><p class="text" data-v-653fc4a4>DocumentCreateCommitFailedEvent</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-3 is-link" data-v-653fc4a4 data-v-653fc4a4><div class="item" data-v-653fc4a4><div class="indicator" data-v-653fc4a4></div><a class="VPLink link link" href="/primitive-docs/reference/js-bao-wss-client/api/interfaces/DocumentEvent.html" data-v-653fc4a4><!--[--><p class="text" data-v-653fc4a4>DocumentEvent</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-3 is-link" data-v-653fc4a4 data-v-653fc4a4><div class="item" data-v-653fc4a4><div class="indicator" data-v-653fc4a4></div><a class="VPLink link link" href="/primitive-docs/reference/js-bao-wss-client/api/interfaces/DocumentInfo.html" data-v-653fc4a4><!--[--><p class="text" data-v-653fc4a4>DocumentInfo</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-3 is-link" data-v-653fc4a4 data-v-653fc4a4><div class="item" data-v-653fc4a4><div class="indicator" data-v-653fc4a4></div><a class="VPLink link link" href="/primitive-docs/reference/js-bao-wss-client/api/interfaces/DocumentInvitation.html" data-v-653fc4a4><!--[--><p class="text" data-v-653fc4a4>DocumentInvitation</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-3 is-link" data-v-653fc4a4 data-v-653fc4a4><div class="item" data-v-653fc4a4><div class="indicator" data-v-653fc4a4></div><a class="VPLink link link" href="/primitive-docs/reference/js-bao-wss-client/api/interfaces/DocumentInvitationResponse.html" data-v-653fc4a4><!--[--><p class="text" data-v-653fc4a4>DocumentInvitationResponse</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-3 is-link" data-v-653fc4a4 data-v-653fc4a4><div class="item" data-v-653fc4a4><div class="indicator" data-v-653fc4a4></div><a class="VPLink link link" href="/primitive-docs/reference/js-bao-wss-client/api/interfaces/DocumentMetadataChangedEvent.html" data-v-653fc4a4><!--[--><p class="text" data-v-653fc4a4>DocumentMetadataChangedEvent</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-3 is-link" data-v-653fc4a4 data-v-653fc4a4><div class="item" data-v-653fc4a4><div class="indicator" data-v-653fc4a4></div><a class="VPLink link link" href="/primitive-docs/reference/js-bao-wss-client/api/interfaces/DocumentPermissionEntry.html" data-v-653fc4a4><!--[--><p class="text" data-v-653fc4a4>DocumentPermissionEntry</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-3 is-link" data-v-653fc4a4 data-v-653fc4a4><div class="item" data-v-653fc4a4><div class="indicator" data-v-653fc4a4></div><a class="VPLink link link" href="/primitive-docs/reference/js-bao-wss-client/api/interfaces/GeminiGenerateRawOptions.html" data-v-653fc4a4><!--[--><p class="text" data-v-653fc4a4>GeminiGenerateRawOptions</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-3 is-link" data-v-653fc4a4 data-v-653fc4a4><div class="item" data-v-653fc4a4><div class="indicator" data-v-653fc4a4></div><a class="VPLink link link" href="/primitive-docs/reference/js-bao-wss-client/api/interfaces/GeminiGenerateResult.html" data-v-653fc4a4><!--[--><p class="text" data-v-653fc4a4>GeminiGenerateResult</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-3 is-link" data-v-653fc4a4 data-v-653fc4a4><div class="item" data-v-653fc4a4><div class="indicator" data-v-653fc4a4></div><a class="VPLink link link" href="/primitive-docs/reference/js-bao-wss-client/api/interfaces/GeminiMessage.html" data-v-653fc4a4><!--[--><p class="text" data-v-653fc4a4>GeminiMessage</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-3 is-link" data-v-653fc4a4 data-v-653fc4a4><div class="item" data-v-653fc4a4><div class="indicator" data-v-653fc4a4></div><a class="VPLink link link" href="/primitive-docs/reference/js-bao-wss-client/api/interfaces/GeminiModelSummary.html" data-v-653fc4a4><!--[--><p class="text" data-v-653fc4a4>GeminiModelSummary</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-3 is-link" data-v-653fc4a4 data-v-653fc4a4><div class="item" data-v-653fc4a4><div class="indicator" data-v-653fc4a4></div><a class="VPLink link link" href="/primitive-docs/reference/js-bao-wss-client/api/interfaces/GeminiPromptOptions.html" data-v-653fc4a4><!--[--><p class="text" data-v-653fc4a4>GeminiPromptOptions</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-3 is-link" data-v-653fc4a4 data-v-653fc4a4><div class="item" data-v-653fc4a4><div class="indicator" data-v-653fc4a4></div><a class="VPLink link link" href="/primitive-docs/reference/js-bao-wss-client/api/interfaces/GeminiStructuredOutput.html" data-v-653fc4a4><!--[--><p class="text" data-v-653fc4a4>GeminiStructuredOutput</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-3 is-link" data-v-653fc4a4 data-v-653fc4a4><div class="item" data-v-653fc4a4><div class="indicator" data-v-653fc4a4></div><a class="VPLink link link" href="/primitive-docs/reference/js-bao-wss-client/api/interfaces/IntegrationCallRequest.html" data-v-653fc4a4><!--[--><p class="text" data-v-653fc4a4>IntegrationCallRequest</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-3 is-link" data-v-653fc4a4 data-v-653fc4a4><div class="item" data-v-653fc4a4><div class="indicator" data-v-653fc4a4></div><a class="VPLink link link" href="/primitive-docs/reference/js-bao-wss-client/api/interfaces/IntegrationCallResponse.html" data-v-653fc4a4><!--[--><p class="text" data-v-653fc4a4>IntegrationCallResponse</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-3 is-link" data-v-653fc4a4 data-v-653fc4a4><div class="item" data-v-653fc4a4><div class="indicator" data-v-653fc4a4></div><a class="VPLink link link" href="/primitive-docs/reference/js-bao-wss-client/api/interfaces/IntegrationsAPI.html" data-v-653fc4a4><!--[--><p class="text" data-v-653fc4a4>IntegrationsAPI</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-3 is-link" data-v-653fc4a4 data-v-653fc4a4><div class="item" data-v-653fc4a4><div class="indicator" data-v-653fc4a4></div><a class="VPLink link link" href="/primitive-docs/reference/js-bao-wss-client/api/interfaces/InvitationEvent.html" data-v-653fc4a4><!--[--><p class="text" data-v-653fc4a4>InvitationEvent</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-3 is-link" data-v-653fc4a4 data-v-653fc4a4><div class="item" data-v-653fc4a4><div class="indicator" data-v-653fc4a4></div><a class="VPLink link link" href="/primitive-docs/reference/js-bao-wss-client/api/interfaces/JsBaoClientOptions.html" data-v-653fc4a4><!--[--><p class="text" data-v-653fc4a4>JsBaoClientOptions</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-3 is-link" data-v-653fc4a4 data-v-653fc4a4><div class="item" data-v-653fc4a4><div class="indicator" data-v-653fc4a4></div><a class="VPLink link link" href="/primitive-docs/reference/js-bao-wss-client/api/interfaces/JsBaoEvents.html" data-v-653fc4a4><!--[--><p class="text" data-v-653fc4a4>JsBaoEvents</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-3 is-link" data-v-653fc4a4 data-v-653fc4a4><div class="item" data-v-653fc4a4><div class="indicator" data-v-653fc4a4></div><a class="VPLink link link" href="/primitive-docs/reference/js-bao-wss-client/api/interfaces/LlmChatOptions.html" data-v-653fc4a4><!--[--><p class="text" data-v-653fc4a4>LlmChatOptions</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-3 is-link" data-v-653fc4a4 data-v-653fc4a4><div class="item" data-v-653fc4a4><div class="indicator" data-v-653fc4a4></div><a class="VPLink link link" href="/primitive-docs/reference/js-bao-wss-client/api/interfaces/MeUpdatedEvent.html" data-v-653fc4a4><!--[--><p class="text" data-v-653fc4a4>MeUpdatedEvent</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-3 is-link" data-v-653fc4a4 data-v-653fc4a4><div class="item" data-v-653fc4a4><div class="indicator" data-v-653fc4a4></div><a class="VPLink link link" href="/primitive-docs/reference/js-bao-wss-client/api/interfaces/MeUpdateFailedEvent.html" data-v-653fc4a4><!--[--><p class="text" data-v-653fc4a4>MeUpdateFailedEvent</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-3 is-link" data-v-653fc4a4 data-v-653fc4a4><div class="item" data-v-653fc4a4><div class="indicator" data-v-653fc4a4></div><a class="VPLink link link" href="/primitive-docs/reference/js-bao-wss-client/api/interfaces/NetworkModeEvent.html" data-v-653fc4a4><!--[--><p class="text" data-v-653fc4a4>NetworkModeEvent</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-3 is-link" data-v-653fc4a4 data-v-653fc4a4><div class="item" data-v-653fc4a4><div class="indicator" data-v-653fc4a4></div><a class="VPLink link link" href="/primitive-docs/reference/js-bao-wss-client/api/interfaces/OfflineAuthEnabledEvent.html" data-v-653fc4a4><!--[--><p class="text" data-v-653fc4a4>OfflineAuthEnabledEvent</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-3 is-link" data-v-653fc4a4 data-v-653fc4a4><div class="item" data-v-653fc4a4><div class="indicator" data-v-653fc4a4></div><a class="VPLink link link" href="/primitive-docs/reference/js-bao-wss-client/api/interfaces/OfflineAuthExpiringSoonEvent.html" data-v-653fc4a4><!--[--><p class="text" data-v-653fc4a4>OfflineAuthExpiringSoonEvent</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-3 is-link" data-v-653fc4a4 data-v-653fc4a4><div class="item" data-v-653fc4a4><div class="indicator" data-v-653fc4a4></div><a class="VPLink link link" href="/primitive-docs/reference/js-bao-wss-client/api/interfaces/OfflineAuthFailedEvent.html" data-v-653fc4a4><!--[--><p class="text" data-v-653fc4a4>OfflineAuthFailedEvent</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-3 is-link" data-v-653fc4a4 data-v-653fc4a4><div class="item" data-v-653fc4a4><div class="indicator" data-v-653fc4a4></div><a class="VPLink link link" href="/primitive-docs/reference/js-bao-wss-client/api/interfaces/OfflineAuthRenewedEvent.html" data-v-653fc4a4><!--[--><p class="text" data-v-653fc4a4>OfflineAuthRenewedEvent</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-3 is-link" data-v-653fc4a4 data-v-653fc4a4><div class="item" data-v-653fc4a4><div class="indicator" data-v-653fc4a4></div><a class="VPLink link link" href="/primitive-docs/reference/js-bao-wss-client/api/interfaces/OfflineAuthUnlockedEvent.html" data-v-653fc4a4><!--[--><p class="text" data-v-653fc4a4>OfflineAuthUnlockedEvent</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-3 is-link" data-v-653fc4a4 data-v-653fc4a4><div class="item" data-v-653fc4a4><div class="indicator" data-v-653fc4a4></div><a class="VPLink link link" href="/primitive-docs/reference/js-bao-wss-client/api/interfaces/PendingCreateCommittedEvent.html" data-v-653fc4a4><!--[--><p class="text" data-v-653fc4a4>PendingCreateCommittedEvent</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-3 is-link" data-v-653fc4a4 data-v-653fc4a4><div class="item" data-v-653fc4a4><div class="indicator" data-v-653fc4a4></div><a class="VPLink link link" href="/primitive-docs/reference/js-bao-wss-client/api/interfaces/PendingCreateFailedEvent.html" data-v-653fc4a4><!--[--><p class="text" data-v-653fc4a4>PendingCreateFailedEvent</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-3 is-link" data-v-653fc4a4 data-v-653fc4a4><div class="item" data-v-653fc4a4><div class="indicator" data-v-653fc4a4></div><a class="VPLink link link" href="/primitive-docs/reference/js-bao-wss-client/api/interfaces/PermissionEvent.html" data-v-653fc4a4><!--[--><p class="text" data-v-653fc4a4>PermissionEvent</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-3 is-link" data-v-653fc4a4 data-v-653fc4a4><div class="item" data-v-653fc4a4><div class="indicator" data-v-653fc4a4></div><a class="VPLink link link" href="/primitive-docs/reference/js-bao-wss-client/api/interfaces/ReasoningOptions.html" data-v-653fc4a4><!--[--><p class="text" data-v-653fc4a4>ReasoningOptions</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-3 is-link" data-v-653fc4a4 data-v-653fc4a4><div class="item" data-v-653fc4a4><div class="indicator" data-v-653fc4a4></div><a class="VPLink link link" href="/primitive-docs/reference/js-bao-wss-client/api/interfaces/SessionInfo.html" data-v-653fc4a4><!--[--><p class="text" data-v-653fc4a4>SessionInfo</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-3 is-link" data-v-653fc4a4 data-v-653fc4a4><div class="item" data-v-653fc4a4><div class="indicator" data-v-653fc4a4></div><a class="VPLink link link" href="/primitive-docs/reference/js-bao-wss-client/api/interfaces/StatusChangedEvent.html" data-v-653fc4a4><!--[--><p class="text" data-v-653fc4a4>StatusChangedEvent</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-3 is-link" data-v-653fc4a4 data-v-653fc4a4><div class="item" data-v-653fc4a4><div class="indicator" data-v-653fc4a4></div><a class="VPLink link link" href="/primitive-docs/reference/js-bao-wss-client/api/interfaces/UserProfile.html" data-v-653fc4a4><!--[--><p class="text" data-v-653fc4a4>UserProfile</p><!--]--></a><!----></div><!----></div><!--]--></div></section><section class="VPSidebarItem level-2 collapsible collapsed" data-v-653fc4a4 data-v-653fc4a4><div class="item" role="button" tabindex="0" data-v-653fc4a4><div class="indicator" data-v-653fc4a4></div><h4 class="text" data-v-653fc4a4>Type Aliases</h4><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-653fc4a4><span class="vpi-chevron-right caret-icon" data-v-653fc4a4></span></div></div><div class="items" data-v-653fc4a4><!--[--><div class="VPSidebarItem level-3 is-link" data-v-653fc4a4 data-v-653fc4a4><div class="item" data-v-653fc4a4><div class="indicator" data-v-653fc4a4></div><a class="VPLink link link" href="/primitive-docs/reference/js-bao-wss-client/api/type-aliases/GeminiContentPart.html" data-v-653fc4a4><!--[--><p class="text" data-v-653fc4a4>GeminiContentPart</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-3 is-link" data-v-653fc4a4 data-v-653fc4a4><div class="item" data-v-653fc4a4><div class="indicator" data-v-653fc4a4></div><a class="VPLink link link" href="/primitive-docs/reference/js-bao-wss-client/api/type-aliases/GeminiGenerateOptions.html" data-v-653fc4a4><!--[--><p class="text" data-v-653fc4a4>GeminiGenerateOptions</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-3 is-link" data-v-653fc4a4 data-v-653fc4a4><div class="item" data-v-653fc4a4><div class="indicator" data-v-653fc4a4></div><a class="VPLink link link" href="/primitive-docs/reference/js-bao-wss-client/api/type-aliases/GeminiRole.html" data-v-653fc4a4><!--[--><p class="text" data-v-653fc4a4>GeminiRole</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-3 is-link" data-v-653fc4a4 data-v-653fc4a4><div class="item" data-v-653fc4a4><div class="indicator" data-v-653fc4a4></div><a class="VPLink link link" href="/primitive-docs/reference/js-bao-wss-client/api/type-aliases/JsBaoErrorCode.html" data-v-653fc4a4><!--[--><p class="text" data-v-653fc4a4>JsBaoErrorCode</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-3 is-link" data-v-653fc4a4 data-v-653fc4a4><div class="item" data-v-653fc4a4><div class="indicator" data-v-653fc4a4></div><a class="VPLink link link" href="/primitive-docs/reference/js-bao-wss-client/api/type-aliases/TypedModelConstructor.html" data-v-653fc4a4><!--[--><p class="text" data-v-653fc4a4>TypedModelConstructor</p><!--]--></a><!----></div><!----></div><!--]--></div></section><!--]--></div></section><section class="VPSidebarItem level-1 collapsible collapsed" data-v-653fc4a4 data-v-653fc4a4><div class="item" role="button" tabindex="0" data-v-653fc4a4><div class="indicator" data-v-653fc4a4></div><h3 class="text" data-v-653fc4a4>js-bao</h3><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-653fc4a4><span class="vpi-chevron-right caret-icon" data-v-653fc4a4></span></div></div><div class="items" data-v-653fc4a4><!--[--><section class="VPSidebarItem level-2 collapsible collapsed" data-v-653fc4a4 data-v-653fc4a4><div class="item" role="button" tabindex="0" data-v-653fc4a4><div class="indicator" data-v-653fc4a4></div><h4 class="text" data-v-653fc4a4>Classes</h4><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-653fc4a4><span class="vpi-chevron-right caret-icon" data-v-653fc4a4></span></div></div><div class="items" data-v-653fc4a4><!--[--><div class="VPSidebarItem level-3 is-link" data-v-653fc4a4 data-v-653fc4a4><div class="item" data-v-653fc4a4><div class="indicator" data-v-653fc4a4></div><a class="VPLink link link" href="/primitive-docs/reference/js-bao/api/classes/BaseModel.html" data-v-653fc4a4><!--[--><p class="text" data-v-653fc4a4>BaseModel</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-3 is-link" data-v-653fc4a4 data-v-653fc4a4><div class="item" data-v-653fc4a4><div class="indicator" data-v-653fc4a4></div><a class="VPLink link link" href="/primitive-docs/reference/js-bao/api/classes/DatabaseEngine.html" data-v-653fc4a4><!--[--><p class="text" data-v-653fc4a4>DatabaseEngine</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-3 is-link" data-v-653fc4a4 data-v-653fc4a4><div class="item" data-v-653fc4a4><div class="indicator" data-v-653fc4a4></div><a class="VPLink link link" href="/primitive-docs/reference/js-bao/api/classes/DocumentClosedError.html" data-v-653fc4a4><!--[--><p class="text" data-v-653fc4a4>DocumentClosedError</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-3 is-link" data-v-653fc4a4 data-v-653fc4a4><div class="item" data-v-653fc4a4><div class="indicator" data-v-653fc4a4></div><a class="VPLink link link" href="/primitive-docs/reference/js-bao/api/classes/DocumentResolutionError.html" data-v-653fc4a4><!--[--><p class="text" data-v-653fc4a4>DocumentResolutionError</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-3 is-link" data-v-653fc4a4 data-v-653fc4a4><div class="item" data-v-653fc4a4><div class="indicator" data-v-653fc4a4></div><a class="VPLink link link" href="/primitive-docs/reference/js-bao/api/classes/Logger.html" data-v-653fc4a4><!--[--><p class="text" data-v-653fc4a4>Logger</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-3 is-link" data-v-653fc4a4 data-v-653fc4a4><div class="item" data-v-653fc4a4><div class="indicator" data-v-653fc4a4></div><a class="VPLink link link" href="/primitive-docs/reference/js-bao/api/classes/ModelRegistry.html" data-v-653fc4a4><!--[--><p class="text" data-v-653fc4a4>ModelRegistry</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-3 is-link" data-v-653fc4a4 data-v-653fc4a4><div class="item" data-v-653fc4a4><div class="indicator" data-v-653fc4a4></div><a class="VPLink link link" href="/primitive-docs/reference/js-bao/api/classes/RecordNotFoundError.html" data-v-653fc4a4><!--[--><p class="text" data-v-653fc4a4>RecordNotFoundError</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-3 is-link" data-v-653fc4a4 data-v-653fc4a4><div class="item" data-v-653fc4a4><div class="indicator" data-v-653fc4a4></div><a class="VPLink link link" href="/primitive-docs/reference/js-bao/api/classes/StringSet.html" data-v-653fc4a4><!--[--><p class="text" data-v-653fc4a4>StringSet</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-3 is-link" data-v-653fc4a4 data-v-653fc4a4><div class="item" data-v-653fc4a4><div class="indicator" data-v-653fc4a4></div><a class="VPLink link link" href="/primitive-docs/reference/js-bao/api/classes/UniqueConstraintViolationError.html" data-v-653fc4a4><!--[--><p class="text" data-v-653fc4a4>UniqueConstraintViolationError</p><!--]--></a><!----></div><!----></div><!--]--></div></section><section class="VPSidebarItem level-2 collapsible collapsed" data-v-653fc4a4 data-v-653fc4a4><div class="item" role="button" tabindex="0" data-v-653fc4a4><div class="indicator" data-v-653fc4a4></div><h4 class="text" data-v-653fc4a4>Functions</h4><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-653fc4a4><span class="vpi-chevron-right caret-icon" data-v-653fc4a4></span></div></div><div class="items" data-v-653fc4a4><!--[--><div class="VPSidebarItem level-3 is-link" data-v-653fc4a4 data-v-653fc4a4><div class="item" data-v-653fc4a4><div class="indicator" data-v-653fc4a4></div><a class="VPLink link link" href="/primitive-docs/reference/js-bao/api/functions/attachAndRegisterModel.html" data-v-653fc4a4><!--[--><p class="text" data-v-653fc4a4>attachAndRegisterModel</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-3 is-link" data-v-653fc4a4 data-v-653fc4a4><div class="item" data-v-653fc4a4><div class="indicator" data-v-653fc4a4></div><a class="VPLink link link" href="/primitive-docs/reference/js-bao/api/functions/attachSchemaToClass.html" data-v-653fc4a4><!--[--><p class="text" data-v-653fc4a4>attachSchemaToClass</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-3 is-link" data-v-653fc4a4 data-v-653fc4a4><div class="item" data-v-653fc4a4><div class="indicator" data-v-653fc4a4></div><a class="VPLink link link" href="/primitive-docs/reference/js-bao/api/functions/autoRegisterModel.html" data-v-653fc4a4><!--[--><p class="text" data-v-653fc4a4>autoRegisterModel</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-3 is-link" data-v-653fc4a4 data-v-653fc4a4><div class="item" data-v-653fc4a4><div class="indicator" data-v-653fc4a4></div><a class="VPLink link link" href="/primitive-docs/reference/js-bao/api/functions/createModelClass.html" data-v-653fc4a4><!--[--><p class="text" data-v-653fc4a4>createModelClass</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-3 is-link" data-v-653fc4a4 data-v-653fc4a4><div class="item" data-v-653fc4a4><div class="indicator" data-v-653fc4a4></div><a class="VPLink link link" href="/primitive-docs/reference/js-bao/api/functions/defineModelSchema.html" data-v-653fc4a4><!--[--><p class="text" data-v-653fc4a4>defineModelSchema</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-3 is-link" data-v-653fc4a4 data-v-653fc4a4><div class="item" data-v-653fc4a4><div class="indicator" data-v-653fc4a4></div><a class="VPLink link link" href="/primitive-docs/reference/js-bao/api/functions/dumpYDocToPlain.html" data-v-653fc4a4><!--[--><p class="text" data-v-653fc4a4>dumpYDocToPlain</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-3 is-link" data-v-653fc4a4 data-v-653fc4a4><div class="item" data-v-653fc4a4><div class="indicator" data-v-653fc4a4></div><a class="VPLink link link" href="/primitive-docs/reference/js-bao/api/functions/Field.html" data-v-653fc4a4><!--[--><p class="text" data-v-653fc4a4>Field</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-3 is-link" data-v-653fc4a4 data-v-653fc4a4><div class="item" data-v-653fc4a4><div class="indicator" data-v-653fc4a4></div><a class="VPLink link link" href="/primitive-docs/reference/js-bao/api/functions/generateULID.html" data-v-653fc4a4><!--[--><p class="text" data-v-653fc4a4>generateULID</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-3 is-link" data-v-653fc4a4 data-v-653fc4a4><div class="item" data-v-653fc4a4><div class="indicator" data-v-653fc4a4></div><a class="VPLink link link" href="/primitive-docs/reference/js-bao/api/functions/initJsBao.html" data-v-653fc4a4><!--[--><p class="text" data-v-653fc4a4>initJsBao</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-3 is-link" data-v-653fc4a4 data-v-653fc4a4><div class="item" data-v-653fc4a4><div class="indicator" data-v-653fc4a4></div><a class="VPLink link link" href="/primitive-docs/reference/js-bao/api/functions/Model.html" data-v-653fc4a4><!--[--><p class="text" data-v-653fc4a4>Model</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-3 is-link" data-v-653fc4a4 data-v-653fc4a4><div class="item" data-v-653fc4a4><div class="indicator" data-v-653fc4a4></div><a class="VPLink link link" href="/primitive-docs/reference/js-bao/api/functions/resetJsBao.html" data-v-653fc4a4><!--[--><p class="text" data-v-653fc4a4>resetJsBao</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-3 is-link" data-v-653fc4a4 data-v-653fc4a4><div class="item" data-v-653fc4a4><div class="indicator" data-v-653fc4a4></div><a class="VPLink link link" href="/primitive-docs/reference/js-bao/api/functions/summarizePlainYDoc.html" data-v-653fc4a4><!--[--><p class="text" data-v-653fc4a4>summarizePlainYDoc</p><!--]--></a><!----></div><!----></div><!--]--></div></section><section class="VPSidebarItem level-2 collapsible collapsed" data-v-653fc4a4 data-v-653fc4a4><div class="item" role="button" tabindex="0" data-v-653fc4a4><div class="indicator" data-v-653fc4a4></div><h4 class="text" data-v-653fc4a4>Interfaces</h4><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-653fc4a4><span class="vpi-chevron-right caret-icon" data-v-653fc4a4></span></div></div><div class="items" data-v-653fc4a4><!--[--><div class="VPSidebarItem level-3 is-link" data-v-653fc4a4 data-v-653fc4a4><div class="item" data-v-653fc4a4><div class="indicator" data-v-653fc4a4></div><a class="VPLink link link" href="/primitive-docs/reference/js-bao/api/interfaces/ConnectedDocument.html" data-v-653fc4a4><!--[--><p class="text" data-v-653fc4a4>ConnectedDocument</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-3 is-link" data-v-653fc4a4 data-v-653fc4a4><div class="item" data-v-653fc4a4><div class="indicator" data-v-653fc4a4></div><a class="VPLink link link" href="/primitive-docs/reference/js-bao/api/interfaces/DatabaseConfig.html" data-v-653fc4a4><!--[--><p class="text" data-v-653fc4a4>DatabaseConfig</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-3 is-link" data-v-653fc4a4 data-v-653fc4a4><div class="item" data-v-653fc4a4><div class="indicator" data-v-653fc4a4></div><a class="VPLink link link" href="/primitive-docs/reference/js-bao/api/interfaces/DocumentConnectionEvent.html" data-v-653fc4a4><!--[--><p class="text" data-v-653fc4a4>DocumentConnectionEvent</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-3 is-link" data-v-653fc4a4 data-v-653fc4a4><div class="item" data-v-653fc4a4><div class="indicator" data-v-653fc4a4></div><a class="VPLink link link" href="/primitive-docs/reference/js-bao/api/interfaces/DocumentManager.html" data-v-653fc4a4><!--[--><p class="text" data-v-653fc4a4>DocumentManager</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-3 is-link" data-v-653fc4a4 data-v-653fc4a4><div class="item" data-v-653fc4a4><div class="indicator" data-v-653fc4a4></div><a class="VPLink link link" href="/primitive-docs/reference/js-bao/api/interfaces/DumpOptions.html" data-v-653fc4a4><!--[--><p class="text" data-v-653fc4a4>DumpOptions</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-3 is-link" data-v-653fc4a4 data-v-653fc4a4><div class="item" data-v-653fc4a4><div class="indicator" data-v-653fc4a4></div><a class="VPLink link link" href="/primitive-docs/reference/js-bao/api/interfaces/DumpSummary.html" data-v-653fc4a4><!--[--><p class="text" data-v-653fc4a4>DumpSummary</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-3 is-link" data-v-653fc4a4 data-v-653fc4a4><div class="item" data-v-653fc4a4><div class="indicator" data-v-653fc4a4></div><a class="VPLink link link" href="/primitive-docs/reference/js-bao/api/interfaces/DumpSummaryEntry.html" data-v-653fc4a4><!--[--><p class="text" data-v-653fc4a4>DumpSummaryEntry</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-3 is-link" data-v-653fc4a4 data-v-653fc4a4><div class="item" data-v-653fc4a4><div class="indicator" data-v-653fc4a4></div><a class="VPLink link link" href="/primitive-docs/reference/js-bao/api/interfaces/FieldOptions.html" data-v-653fc4a4><!--[--><p class="text" data-v-653fc4a4>FieldOptions</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-3 is-link" data-v-653fc4a4 data-v-653fc4a4><div class="item" data-v-653fc4a4><div class="indicator" data-v-653fc4a4></div><a class="VPLink link link" href="/primitive-docs/reference/js-bao/api/interfaces/InitJsBaoOptions.html" data-v-653fc4a4><!--[--><p class="text" data-v-653fc4a4>InitJsBaoOptions</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-3 is-link" data-v-653fc4a4 data-v-653fc4a4><div class="item" data-v-653fc4a4><div class="indicator" data-v-653fc4a4></div><a class="VPLink link link" href="/primitive-docs/reference/js-bao/api/interfaces/InitJsBaoResult.html" data-v-653fc4a4><!--[--><p class="text" data-v-653fc4a4>InitJsBaoResult</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-3 is-link" data-v-653fc4a4 data-v-653fc4a4><div class="item" data-v-653fc4a4><div class="indicator" data-v-653fc4a4></div><a class="VPLink link link" href="/primitive-docs/reference/js-bao/api/interfaces/ModelOptions.html" data-v-653fc4a4><!--[--><p class="text" data-v-653fc4a4>ModelOptions</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-3 is-link" data-v-653fc4a4 data-v-653fc4a4><div class="item" data-v-653fc4a4><div class="indicator" data-v-653fc4a4></div><a class="VPLink link link" href="/primitive-docs/reference/js-bao/api/interfaces/PaginatedResult.html" data-v-653fc4a4><!--[--><p class="text" data-v-653fc4a4>PaginatedResult</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-3 is-link" data-v-653fc4a4 data-v-653fc4a4><div class="item" data-v-653fc4a4><div class="indicator" data-v-653fc4a4></div><a class="VPLink link link" href="/primitive-docs/reference/js-bao/api/interfaces/PaginationOptions.html" data-v-653fc4a4><!--[--><p class="text" data-v-653fc4a4>PaginationOptions</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-3 is-link" data-v-653fc4a4 data-v-653fc4a4><div class="item" data-v-653fc4a4><div class="indicator" data-v-653fc4a4></div><a class="VPLink link link" href="/primitive-docs/reference/js-bao/api/interfaces/QueryOptions.html" data-v-653fc4a4><!--[--><p class="text" data-v-653fc4a4>QueryOptions</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-3 is-link" data-v-653fc4a4 data-v-653fc4a4><div class="item" data-v-653fc4a4><div class="indicator" data-v-653fc4a4></div><a class="VPLink link link" href="/primitive-docs/reference/js-bao/api/interfaces/SaveOptions.html" data-v-653fc4a4><!--[--><p class="text" data-v-653fc4a4>SaveOptions</p><!--]--></a><!----></div><!----></div><!--]--></div></section><section class="VPSidebarItem level-2 collapsible collapsed" data-v-653fc4a4 data-v-653fc4a4><div class="item" role="button" tabindex="0" data-v-653fc4a4><div class="indicator" data-v-653fc4a4></div><h4 class="text" data-v-653fc4a4>Type Aliases</h4><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-653fc4a4><span class="vpi-chevron-right caret-icon" data-v-653fc4a4></span></div></div><div class="items" data-v-653fc4a4><!--[--><div class="VPSidebarItem level-3 is-link" data-v-653fc4a4 data-v-653fc4a4><div class="item" data-v-653fc4a4><div class="indicator" data-v-653fc4a4></div><a class="VPLink link link" href="/primitive-docs/reference/js-bao/api/type-aliases/DocumentConnectionCallback.html" data-v-653fc4a4><!--[--><p class="text" data-v-653fc4a4>DocumentConnectionCallback</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-3 is-link" data-v-653fc4a4 data-v-653fc4a4><div class="item" data-v-653fc4a4><div class="indicator" data-v-653fc4a4></div><a class="VPLink link link" href="/primitive-docs/reference/js-bao/api/type-aliases/DocumentFilter.html" data-v-653fc4a4><!--[--><p class="text" data-v-653fc4a4>DocumentFilter</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-3 is-link" data-v-653fc4a4 data-v-653fc4a4><div class="item" data-v-653fc4a4><div class="indicator" data-v-653fc4a4></div><a class="VPLink link link" href="/primitive-docs/reference/js-bao/api/type-aliases/DocumentPermissionHint.html" data-v-653fc4a4><!--[--><p class="text" data-v-653fc4a4>DocumentPermissionHint</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-3 is-link" data-v-653fc4a4 data-v-653fc4a4><div class="item" data-v-653fc4a4><div class="indicator" data-v-653fc4a4></div><a class="VPLink link link" href="/primitive-docs/reference/js-bao/api/type-aliases/InferAttrs.html" data-v-653fc4a4><!--[--><p class="text" data-v-653fc4a4>InferAttrs</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-3 is-link" data-v-653fc4a4 data-v-653fc4a4><div class="item" data-v-653fc4a4><div class="indicator" data-v-653fc4a4></div><a class="VPLink link link" href="/primitive-docs/reference/js-bao/api/type-aliases/ModelConstructor.html" data-v-653fc4a4><!--[--><p class="text" data-v-653fc4a4>ModelConstructor</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-3 is-link" data-v-653fc4a4 data-v-653fc4a4><div class="item" data-v-653fc4a4><div class="indicator" data-v-653fc4a4></div><a class="VPLink link link" href="/primitive-docs/reference/js-bao/api/type-aliases/PlainYDoc.html" data-v-653fc4a4><!--[--><p class="text" data-v-653fc4a4>PlainYDoc</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-3 is-link" data-v-653fc4a4 data-v-653fc4a4><div class="item" data-v-653fc4a4><div class="indicator" data-v-653fc4a4></div><a class="VPLink link link" href="/primitive-docs/reference/js-bao/api/type-aliases/ProjectionSpec.html" data-v-653fc4a4><!--[--><p class="text" data-v-653fc4a4>ProjectionSpec</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-3 is-link" data-v-653fc4a4 data-v-653fc4a4><div class="item" data-v-653fc4a4><div class="indicator" data-v-653fc4a4></div><a class="VPLink link link" href="/primitive-docs/reference/js-bao/api/type-aliases/QueryResult.html" data-v-653fc4a4><!--[--><p class="text" data-v-653fc4a4>QueryResult</p><!--]--></a><!----></div><!----></div><!--]--></div></section><!--]--></div></section><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-b0764d2a data-v-a28c2434><div class="VPDoc has-sidebar has-aside" data-v-a28c2434 data-v-f13de798><!--[--><!--]--><div class="container" data-v-f13de798><div class="aside" data-v-f13de798><div class="aside-curtain" data-v-f13de798></div><div class="aside-container" data-v-f13de798><div class="aside-content" data-v-f13de798><div class="VPDocAside" data-v-f13de798 data-v-5681380b><!--[--><!--]--><!--[--><!--]--><nav aria-labelledby="doc-outline-aria-label" class="VPDocAsideOutline" data-v-5681380b data-v-2198ba7b><div class="content" data-v-2198ba7b><div class="outline-marker" data-v-2198ba7b></div><div aria-level="2" class="outline-title" id="doc-outline-aria-label" role="heading" data-v-2198ba7b>On this page</div><ul class="VPDocOutlineItem root" data-v-2198ba7b data-v-662b38a8><!--[--><!--]--></ul></div></nav><!--[--><!--]--><div class="spacer" data-v-5681380b></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-f13de798><div class="content-container" data-v-f13de798><!--[--><!--]--><main class="main" data-v-f13de798><div style="position:relative;" class="vp-doc _primitive-docs_reference_js-bao-wss-client_api_README" data-v-f13de798><div><p><strong>js-bao-wss-client</strong></p><hr><h1 id="jsbao-client-library" tabindex="-1">JsBao Client Library <a class="header-anchor" href="#jsbao-client-library" aria-label="Permalink to JsBao Client Library"></a></h1><p>A TypeScript/JavaScript client library for js-bao-wss that provides HTTP APIs and real-time collaborative editing using Yjs. This README reflects the current implementation and replaces older docs that referenced removed options/behaviors.</p><h2 id="features" tabindex="-1">Features <a class="header-anchor" href="#features" aria-label="Permalink to Features"></a></h2><ul><li><strong>Document Management</strong>: Create, list, update, delete via HTTP</li><li><strong>Permissions</strong>: Get/update/remove document permissions</li><li><strong>Invitations</strong>: Create/list/update/delete; accept/decline (invitee)</li><li><strong>Realtime Collaboration</strong>: Y.Doc sync over multi-tenant WebSocket</li><li><strong>Awareness</strong>: Presence/cursor broadcast and server-triggered refresh</li><li><strong>Auth/OAuth</strong>: Client-orchestrated OAuth and cookie refresh</li><li><strong>Automatic Reconnect</strong>: Backoff + re-auth on 401</li><li><strong>Token Management</strong>: Proactive refresh in HTTP calls</li><li><strong>Analytics</strong>: Buffered event logging API with optional automatic lifecycle events</li><li><strong>Blob Storage</strong>: Upload/list/get/downloadUrl/delete per document with offline cache</li><li><strong>LLM</strong>: Chat API and model listing</li><li><strong>Offline-first Open</strong>: Non-blocking open with IndexedDB-backed cache</li><li><strong>Offline Blob Cache</strong>: Cache API + IndexedDB backed uploads/reads with eviction and retry</li><li><strong>Network Controls</strong>: Online/offline modes, reachability, connection control</li><li><strong>Root Documents</strong>: Opt-in listing via <code>includeRoot</code></li></ul><h2 id="installation" tabindex="-1">Installation <a class="header-anchor" href="#installation" aria-label="Permalink to Installation"></a></h2><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">npm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> js-bao-wss-client</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Peer dependencies</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">npm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> yjs</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> lib0</span></span></code></pre></div><h2 id="quick-start" tabindex="-1">Quick Start <a class="header-anchor" href="#quick-start" aria-label="Permalink to Quick Start"></a></h2><blockquote><p>Migrating from legacy decorators? Follow <code>src/client/docs/js-bao-v2-migration.md</code> before continuingmodels must now be defined with <code>defineModelSchema</code>/<code>createModelClass</code>.</p></blockquote><h3 id="_1-initialize-the-client" tabindex="-1">1. Initialize the Client <a class="header-anchor" href="#_1-initialize-the-client" aria-label="Permalink to 1. Initialize the Client"></a></h3><p><code>initializeClient(options)</code> constructs <code>JsBaoClient</code>, waits for the embedded database to be ready, and blocks until the new auth bootstrap sequence finishes (persisted JWT, cookie refresh, offline unlock, or OAuth handoff). Always await it before interacting with the client:</p><div class="language-typescript"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  initializeClient,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  defineModelSchema,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  createModelClass,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  InferAttrs,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  TypedModelConstructor,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">} </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;js-bao-wss-client&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> type</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { BaseModel } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;js-bao&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> contactSchema</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> defineModelSchema</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  name: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;contacts&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  fields: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    id: { type: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, autoAssign: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, indexed: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    name: { type: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;string&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, indexed: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    email: { type: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;string&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, indexed: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    status: { type: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;string&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, default: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Active&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">type</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ContactAttrs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> InferAttrs</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">typeof</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> contactSchema&gt;;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">interface</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Contact</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> extends</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ContactAttrs</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">BaseModel</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {}</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Contact</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> TypedModelConstructor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Contact</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> createModelClass</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  schema: contactSchema,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">async</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> bootstrap</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> client</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> initializeClient</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    apiUrl: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;https://your-api.example.com&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    wsUrl: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;wss://your-ws.example.com&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    appId: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;your-app-id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    token: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;your-jwt-token&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// optional for OAuth/bootstrap</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // Optional: override the local query engine (defaults to SQL.js)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    databaseConfig: { type: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;node-sqlite&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, options: { filePath: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;./local.db&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    blobUploadConcurrency: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// optional (default 2 concurrent uploads)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    models: [Contact],</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // Optional behaviors</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    offline: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// enabled by default; set false to disable IndexedDB doc persistence</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    auth: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      persistJwtInStorage: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// optional: reuse short-lived JWT across reloads while valid</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      storageKeyPrefix: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;my-app&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// optional namespace when running multiple clients on same origin</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    autoOAuth: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    oauthRedirectUri: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;https://your-app.com/oauth/callback&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    suppressAutoLoginMs: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">5000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    autoUnlockOfflineOnInit: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    autoNetwork: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    connectivityProbeTimeoutMs: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    onConnectivityCheck: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">undefined</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    globalAdminAppId: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;global-admin-app&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    wsHeaders: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">undefined</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    logLevel: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;info&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    maxReconnectDelay: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">30</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> client;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> client</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> bootstrap</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span></code></pre></div><blockquote><p><strong>Note:</strong> All following examples assume an async context (e.g., inside <code>async function main()</code> or using top-level await) so that <code>await initializeClient(...)</code> is valid.</p></blockquote><h4 id="default-behaviors" tabindex="-1">Default behaviors <a class="header-anchor" href="#default-behaviors" aria-label="Permalink to Default behaviors"></a></h4><ul><li><code>offline</code> mode is enabled unless you pass <code>offline: false</code>.</li><li><code>databaseConfig</code> defaults to <code>{ type: &quot;sqljs&quot; }</code>. Supply a different engine only if you need it.</li></ul><h3 id="_2-listen-to-connection-events" tabindex="-1">2. Listen to Connection Events <a class="header-anchor" href="#_2-listen-to-connection-events" aria-label="Permalink to 2. Listen to Connection Events"></a></h3><div class="language-typescript"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Connection status</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">client.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;status&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, ({ </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">status</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">net</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Connection status:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, status, net); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// status plus network snapshot</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Authentication events</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">client.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;auth-failed&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, ({ </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">message</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Auth failed:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, message);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // Redirect user to login</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">client.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;auth-success&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Authentication successful&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">client.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;auth:onlineAuthRequired&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // Went online without a token; prompt user to sign in</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Connection errors</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">client.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;connection-error&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Connection error:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, error);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Connection close</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">client.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;connection-close&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">event</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Connection closed:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, event.code, event.reason);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Network mode changes</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">client.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;networkMode&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, ({ </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">mode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Network mode:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, mode);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Auth lifecycle</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">client.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;auth:state&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">s</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Auth state:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, s));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">client.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;auth:logout&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {});</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">client.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;auth:logout:complete&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Offline grant lifecycle</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">client.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;offlineAuth:enabled&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {});</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">client.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;offlineAuth:unlocked&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {});</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">client.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;offlineAuth:renewed&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {});</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">client.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;offlineAuth:revoked&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {});</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">client.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;offlineAuth:failed&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {});</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">client.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;offlineAuth:expiringSoon&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, ({ </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">daysLeft</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {});</span></span></code></pre></div><h3 id="analytics" tabindex="-1">Analytics <a class="header-anchor" href="#analytics" aria-label="Permalink to Analytics"></a></h3><p>The client exposes a buffered analytics queue that batches events, retries on reconnect, and shares storage with offline persistence. Use it to emit custom instrumentation or rely on the built-in automatic events described below.</p><h4 id="client-api" tabindex="-1">Client API <a class="header-anchor" href="#client-api" aria-label="Permalink to Client API"></a></h4><ul><li><code>client.analytics.logEvent({ action, feature, context_json?, ... })</code>: enqueue a single event. <code>context_json</code> accepts an object (auto-serialized) or a JSON string.</li><li><code>client.analytics.flush()</code>: attempt to send the queue immediately; also runs automatically on reconnect and right before unload/destroy.</li><li><code>client.analytics.setPlanOverride(plan)</code> and <code>.setAppVersionOverride(version)</code>: stamp metadata onto every subsequent event until you clear or replace it.</li><li><code>client.getLlmAnalyticsContext()</code>: returns <code>{ logEvent, isEnabled }</code> when any LLM auto phases are enabled so higher-level features can coordinate their own analytics.</li></ul><p>Queued events are persisted in IndexedDB when offline storage is active, so short offline windows or reloads do not drop data. Everything funnels through the same <code>analytics.batch</code> WebSocket channel used by the live event test.</p><h4 id="automatic-events" tabindex="-1">Automatic events <a class="header-anchor" href="#automatic-events" aria-label="Permalink to Automatic events"></a></h4><p>All automatic emitters are on by default; pass <code>analyticsAutoEvents</code> when constructing the client to opt out per feature.</p><ul><li><code>user_active_daily</code> (<code>feature: &quot;session&quot;</code>, toggle: <code>analyticsAutoEvents.dailyAuth</code>): first successful auth per calendar day.</li><li><code>user_returned</code> (<code>&quot;session&quot;</code>, respects <code>analyticsAutoEvents.minResumeMs</code>): fired when the tab becomes visible after being hidden long enough. <code>context_json.trigger</code> indicates <code>&quot;visibility&quot;</code> or <code>&quot;manual&quot;</code>.</li><li><code>client_boot</code> (<code>&quot;session&quot;</code>, toggle: <code>analyticsAutoEvents.boot</code>): exactly once per client instance.</li><li><code>first_doc_open</code> / <code>first_doc_edit</code> (<code>&quot;documents&quot;</code>, toggles: <code>analyticsAutoEvents.firstDocOpen</code>, <code>analyticsAutoEvents.firstDocEdit</code>): include the triggering <code>documentId</code>.</li><li><code>offline_recovery</code> (<code>&quot;network&quot;</code>, toggle: <code>analyticsAutoEvents.offlineRecovery.enabled</code>, throttled by <code>minIntervalMs</code>): logged when moving from offline back to online.</li><li><code>sync_error</code> (<code>&quot;sync&quot;</code>, toggle: <code>analyticsAutoEvents.syncErrors.enabled</code>): records the <code>documentId</code> and <code>reason</code> when flush/send attempts fail (with interval throttling).</li><li><code>blob_upload_started</code> / <code>blob_upload_succeeded</code> / <code>blob_upload_failed</code> (<code>&quot;blobs&quot;</code>, toggles: <code>analyticsAutoEvents.blobUploads.{start|success|failure}</code>): include blob/document identifiers, attempt counts, byte size, and retry details (with truncated error text on failure).</li><li><code>service_worker_control</code> / <code>service_worker_token_update</code> (<code>&quot;service_worker&quot;</code>, toggles: <code>analyticsAutoEvents.serviceWorker.{control|tokenUpdate}</code>): cover the bridge taking control and forwarding refreshed tokens (<code>context_json.cause</code> when available).</li><li><code>session_end</code> (<code>&quot;session&quot;</code>, toggle: <code>analyticsAutoEvents.sessionEnd</code>): emitted on <code>beforeunload</code> and <code>client.destroy()</code>, including <code>duration_ms</code> and exit reason.</li><li><code>gemini_request_started</code> / <code>gemini_request_succeeded</code> / <code>gemini_request_failed</code> (<code>&quot;gemini&quot;</code>, toggles: <code>analyticsAutoEvents.gemini.{start|success|failure}</code> or boolean): emitted for <code>client.gemini.generate()</code> and <code>client.gemini.countTokens()</code> lifecycles with model/context metadata.</li></ul><p>When <code>analyticsAutoEvents.llm</code> enables any of <code>start</code>, <code>success</code>, or <code>failure</code>, <code>client.getLlmAnalyticsContext()</code> becomes non-null so LLM helpers can emit structured events without guessing configuration. <code>analyticsAutoEvents.gemini</code> controls <code>client.getGeminiAnalyticsContext()</code>, which powers automatic logging inside the Gemini namespace.</p><p>Example configuration:</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> client</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> initializeClient</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  ...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">options,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  analyticsAutoEvents: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    firstDocEdit: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// suppress milestone if your app logs a custom event</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    blobUploads: { start: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, success: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, failure: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    llm: { start: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, success: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, failure: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span></code></pre></div><p>Manual <code>client.analytics.logEvent(...)</code> calls share the same queue and flush behaviour as the automatic stream, so custom events keep order/metadata without extra plumbing.</p><h3 id="auth-events-reference" tabindex="-1">Auth Events Reference <a class="header-anchor" href="#auth-events-reference" aria-label="Permalink to Auth Events Reference"></a></h3><ul><li><strong>auth-failed</strong>: Access token invalid/expired and refresh failed. Use this to trigger reauthentication. <ul><li>Payload: <code>{ reason?: string; message?: string }</code></li></ul></li><li><strong>auth-success</strong>: Authentication succeeded or token refreshed. <ul><li>Payload: none</li></ul></li><li><strong>auth-refresh-deferred</strong>: Access token refresh was deferred due to connectivity issues. Use this to show &quot;trying to reconnect&quot; UI. <ul><li>Payload: <code>{ status: &quot;scheduled&quot; | &quot;offline&quot;; nextAttemptMs?: number; cause?: string }</code></li></ul></li><li><strong>auth:onlineAuthRequired</strong>: Client attempted to go online without a token. Prompt for sign-in. <ul><li>Payload: none</li></ul></li><li><strong>auth:logout</strong>: Logout flow started (explicit sign-out). Clear app state/stop sensitive activities. <ul><li>Payload: none</li></ul></li><li><strong>auth:logout:complete</strong>: Logout flow finished. <ul><li>Payload: none</li></ul></li><li><strong>auth:state</strong>: Generic auth state changes. <ul><li>Payload: <code>{ authenticated: boolean; mode: &quot;online&quot; | &quot;offline&quot; | &quot;auto&quot; | &quot;none&quot; }</code></li></ul></li></ul><p>Minimal example to react when reauthentication is needed:</p><div class="language-typescript"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> promptLogin</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> navigateToLogin</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">client.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;auth-failed&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, promptLogin);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">client.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;auth:onlineAuthRequired&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, promptLogin);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">client.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;auth:state&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, ({ </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">authenticated</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">authenticated) </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">promptLogin</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span></code></pre></div><h3 id="persisting-short-lived-jwts-optional" tabindex="-1">Persisting short-lived JWTs (optional) <a class="header-anchor" href="#persisting-short-lived-jwts-optional" aria-label="Permalink to Persisting short-lived JWTs (optional)"></a></h3><p>By default the client keeps the access token in memory and relies on the refresh cookie whenever a reload happens. You can opt-in to caching the current short-lived JWT in IndexedDB so that a refresh can be skipped while the token is still valid:</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> client</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> initializeClient</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  ...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">options,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  auth: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    persistJwtInStorage: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    storageKeyPrefix: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;tenant-a&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// optional namespace per app/user sandbox</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> info</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> client.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getAuthPersistenceInfo</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// =&gt; { mode: &quot;persisted&quot;, hydrated: false | true }</span></span></code></pre></div><ul><li>The persisted token is only reused when it remains outside the refresh safety window (roughly 2 minutes before expiry). If the cached token is stale, the client falls back to the existing refresh flow.</li><li><code>storageKeyPrefix</code> lets you isolate multiple client instances that run on the same origin (e.g., multi-tenant dashboards or tests).</li><li>Persistence is cleared automatically on logout, auth failures, or when you disable the feature. Apps that keep the default (<code>persistJwtInStorage</code> omitted) continue to run fully in-memory.</li><li>Offline grants are unaffected; long-lived offline access still hinges on the encrypted grant workflow.</li></ul><h3 id="first-party-refresh-proxy" tabindex="-1">First-party refresh proxy <a class="header-anchor" href="#first-party-refresh-proxy" aria-label="Permalink to First-party refresh proxy"></a></h3><p>Safari and other strict browsers block third-party cookies, so you can opt into a same-origin refresh proxy by wiring the client through your app worker:</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> client</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> initializeClient</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  ...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">options,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  auth: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    refreshProxy: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      baseUrl: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">window</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">location</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">origin</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}/proxy`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      cookieMaxAgeSeconds: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">7</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 24</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 60</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 60</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// optional override (defaults to 7 days)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span></code></pre></div><ul><li><code>baseUrl</code> should be an absolute URL pointing to the first-party worker prefix that forwards to <code>/app/:appId/api/auth/*</code>.</li><li><code>cookieMaxAgeSeconds</code> lets you shorten/extend the refresh cookie TTL; omit it to use the worker default.</li><li>Set <code>enabled: false</code> when you share config across environments but only want the proxy in production.</li><li>Leave <code>auth.refreshProxy</code> undefined to preserve the existing direct-to-API behaviour.</li><li>In local Vite development the sample app leaves the proxy disabled; set <code>VITE_USE_REFRESH_PROXY=true</code> to test the worker path locally.</li></ul><h3 id="document-lifecycle-events" tabindex="-1">Document Lifecycle Events <a class="header-anchor" href="#document-lifecycle-events" aria-label="Permalink to Document Lifecycle Events"></a></h3><div class="language-typescript"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Fires once per open call as soon as the Y.Doc is created and local wiring is ready</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">client.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;documentOpened&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, ({ </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">documentId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;documentOpened:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, documentId);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Fires up to twice per open cycle after the initial wiring is complete:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// - once when initial data is loaded from IndexedDB (browser + offline: true) *after*</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//   the local query engine (SQL.js/SQLite) has replayed/indexed the data</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// - once when the document first becomes synced with the server</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">client.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  &quot;documentLoaded&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ({ </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">documentId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">source</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">hadData</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">bytes</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">elapsedMs</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;documentLoaded:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      documentId,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      source,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      hadData,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      bytes,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      elapsedMs,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Fires after a document is fully closed and all related resources are cleaned up</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">client.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;documentClosed&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, ({ </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">documentId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;documentClosed:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, documentId);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Notes:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// - &#39;indexeddb&#39; emits only when offline persistence is enabled and IndexedDB is available,</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//   and only after the js-bao local query engine finishes connecting (SQLite/SQL.js indexes ready).</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// - &#39;server&#39; emits on first transition to synced per open cycle; hadData/bytes reflect server updates applied.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// - elapsedMs is measured from the start of documents.open for that document.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// - Unsubscribe listeners on unmount to avoid duplicate logs.</span></span></code></pre></div><h3 id="documentmetadatachanged-payload-details" tabindex="-1">documentMetadataChanged: payload details <a class="header-anchor" href="#documentmetadatachanged-payload-details" aria-label="Permalink to documentMetadataChanged: payload details"></a></h3><p>The client emits <code>documentMetadataChanged</code> whenever local metadata changes or server metadata is merged into the local cache.</p><ul><li><p>Payload shape:</p><ul><li><code>{ documentId, metadata, changedFields?, action, source }</code></li><li><strong>action</strong>: <code>&quot;created&quot; | &quot;updated&quot; | &quot;evicted&quot; | &quot;deleted&quot;</code></li><li><strong>source</strong>: <code>&quot;local&quot; | &quot;server&quot;</code></li><li><strong>changedFields</strong>: array of field names that changed (when applicable)</li><li><strong>metadata</strong>: an object with the most recent local view of metadata, or <code>null</code> for <code>evicted</code>/<code>deleted</code></li></ul></li><li><p>Metadata fields (may be partially present):</p><ul><li><code>documentId: string</code></li><li><code>title?: string</code></li><li><code>lastKnownPermission?: &quot;owner&quot; | &quot;read-write&quot; | &quot;reader&quot; | &quot;admin&quot; | null</code></li><li><code>permissionCachedAt?: string</code> (ISO timestamp)</li><li><code>lastOpenedAt?: string</code> (ISO timestamp)</li><li><code>lastSyncedAt?: string</code> (ISO timestamp; updated on successful sync or server-merge)</li><li><code>localBytes?: number</code> (approx bytes of IndexedDB update store when available)</li><li><code>hasUnsyncedLocalChanges?: boolean</code></li><li><code>pendingCreate?: boolean</code> (true for client-created docs pending server commit)</li><li><code>createdAt?: string</code> (ISO timestamp; local create time)</li><li><code>localOnly?: boolean</code> (true for offline-only documents)</li></ul></li><li><p>Typical emissions:</p><ul><li><strong>created/local</strong>: immediately after <code>documents.create(...)</code> updates local cache. <code>changedFields</code> often includes <code>createdAt</code>, <code>pendingCreate</code>, <code>localOnly</code>, and optionally <code>title</code>.</li><li><strong>updated/local</strong>: after local changes such as <code>documents.update(...)</code> (optimistic <code>title</code>), sync status updates (<code>lastSyncedAt</code>, <code>hasUnsyncedLocalChanges</code>), or localBytes refresh.</li></ul></li><li><p><strong>updated/server</strong>: after <code>documents.list({ refreshFromServer: true })</code> or network-first list merges server metadata (e.g., <code>title</code>, <code>permission</code>), <code>changedFields</code> reflects updated properties.</p></li><li><p><strong>evicted/local</strong>: after <code>documents.evict(id)</code> or <code>documents.evictAll(...)</code>; <code>metadata</code> is <code>null</code>.</p></li><li><p><strong>deleted/server or local</strong>: the first delete seen (server push, list refresh, or local <code>documents.delete</code>) emits a single <code>deleted</code> event; subsequent delete/evict/list refreshes for the same doc are suppressed to avoid duplicates (including 404/offline fallbacks after a successful delete).</p></li></ul><p>Example listener:</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">client.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;documentMetadataChanged&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">updates</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> u</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Array.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">isArray</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(updates) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> updates[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> updates;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">u) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // u: { documentId, metadata, changedFields?, action, source }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;metadataChanged&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    u.documentId,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    u.action,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    u.source,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    u.changedFields</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  );</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span></code></pre></div><h2 id="offline-first-open-behavior" tabindex="-1">Offline-first: Open Behavior <a class="header-anchor" href="#offline-first-open-behavior" aria-label="Permalink to Offline-first: Open Behavior"></a></h2><p>The client supports non-blocking open so UIs can render immediately from local cache while network work continues in the background.</p><div class="language-typescript"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">doc</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">metadata</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> client.documents.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">open</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(documentId, {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // Non-blocking knobs</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  waitForLoad: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;localIfAvailableElseNetwork&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// &quot;local&quot; | &quot;network&quot; | &quot;localIfAvailableElseNetwork&quot; (default)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  enableNetworkSync: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// false =&gt; per-doc manual start</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  retainLocal: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// keep local cache on close</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  availabilityWaitMs: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">30000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// network availability timeout (when needed)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Manual start if you opened with enableNetworkSync: false</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> client.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">startNetworkSync</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(documentId);</span></span></code></pre></div><p>Events:</p><ul><li><strong>documentOpened</strong>: Emitted once the Y.Doc exists and wiring is ready (before load events)</li><li><strong>documentLoaded</strong>: Per source (<code>indexeddb</code>/<code>server</code>); the <code>indexeddb</code> leg waits for replay plus SQLite/SQL.js indexing, the <code>server</code> leg fires on first sync. Payload <code>{ documentId, source, hadData, bytes?, elapsedMs }</code>.</li><li><strong>documentClosed</strong>: Emitted after a document is closed and cleanup completes</li><li><strong>permission</strong>: Emitted when permission changes; upgrade to write triggers a sync (respecting start mode)</li><li><strong>documentMetadataChanged</strong>: Unified metadata event. Payload shape: <ul><li><code>{ documentId, metadata, changedFields?, action, source }</code></li><li><code>action</code>: <code>&quot;created&quot; | &quot;updated&quot; | &quot;evicted&quot; | &quot;deleted&quot;</code></li><li><code>source</code>: <code>&quot;local&quot; | &quot;server&quot;</code></li><li><code>metadata</code>: may be <code>null</code> for <code>evicted</code>/<code>deleted</code></li></ul></li><li><strong>pendingCreateCommitted</strong> / <strong>pendingCreateFailed</strong></li><li>Existing: <code>sync</code>, <code>status</code>, <code>awareness</code>, <code>connection-error</code>, <code>connection-close</code></li></ul><h3 id="permission-changes-auto-sync" tabindex="-1">Permission changes auto-sync <a class="header-anchor" href="#permission-changes-auto-sync" aria-label="Permalink to Permission changes auto-sync"></a></h3><p>When a document transitions from non-writable to writable (e.g., <code>reader</code>  <code>read-write</code>), the client automatically runs a sync so earlier local edits are pushed (subject to the document&#39;s start mode).</p><h2 id="network-status-offline-mode" tabindex="-1">Network Status / Offline Mode <a class="header-anchor" href="#network-status-offline-mode" aria-label="Permalink to Network Status / Offline Mode"></a></h2><div class="language-typescript"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">client.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getNetworkStatus</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// { mode: &quot;auto&quot; | &quot;online&quot; | &quot;offline&quot;, transport: &quot;connected&quot;|&quot;connecting&quot;|&quot;disconnected&quot;, isOnline: boolean, connected?: boolean, lastOnlineAt?: string, lastError?: string }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">client.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">isOnline</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// boolean</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> client.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setNetworkMode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;offline&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> client.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">goOffline</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> client.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">goOnline</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// HTTP requests fail fast in offline mode</span></span></code></pre></div><h2 id="metadata-cache-and-local-documents" tabindex="-1">Metadata Cache and Local Documents <a class="header-anchor" href="#metadata-cache-and-local-documents" aria-label="Permalink to Metadata Cache and Local Documents"></a></h2><p>The client maintains an IndexedDB-backed metadata index so apps can render lists and document summaries offline. Local listing is merged into <code>documents.list(...)</code>; the former <code>documents.listLocal()</code> is removed.</p><div class="language-typescript"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// List documents (cache-first with background refresh by default)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> docs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> client.documents.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">list</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  includeRoot: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // Default behavior is cache-first with background refresh when local cache exists</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // You can control it explicitly with waitForLoad (see below)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  waitForLoad: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;localIfAvailableElseNetwork&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// List currently open documents (ids)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> open</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> client.documents.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">listOpen</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Get cached local metadata for a document</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> meta</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> client.documents.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getLocalMetadata</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(documentId);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Evict local data for a document (keeps remote doc intact)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> client.documents.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">evict</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(documentId);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Evict all local data; onlySynced=true avoids unsynced-loss</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> client.documents.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">evictAll</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({ onlySynced: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Configure global retention</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">client.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setRetentionPolicy</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // e.g., { maxDocs?: number, maxBytes?: number, ttlMs?: number, defaultRetain?: &quot;persist&quot; | &quot;session&quot; }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span></code></pre></div><p>Notes:</p><ul><li>The client updates the local metadata cache automatically when <code>documents.list()</code> returns server data (including last-known permission and root doc metadata). Root is always cached from the server but filtered out of the returned list unless you pass <code>includeRoot: true</code>.</li><li>Cache updates emit <code>documentMetadataChanged</code> events (typically with <code>action: &quot;updated&quot;</code>, <code>source: &quot;server&quot;</code>).</li><li>Local eviction emits <code>documentMetadataChanged</code> with <code>action: &quot;evicted&quot;</code>, <code>metadata: null</code>.</li><li>Delete emits a single <code>documentMetadataChanged</code> with <code>action: &quot;deleted&quot;</code>, then evicts locally without a second emission.</li></ul><h3 id="listing-options-waitforload" tabindex="-1">Listing options (waitForLoad) <a class="header-anchor" href="#listing-options-waitforload" aria-label="Permalink to Listing options (waitForLoad)"></a></h3><p><code>documents.list</code> supports the same high-level loading modes as <code>documents.open</code> via <code>waitForLoad</code>:</p><ul><li>&quot;local&quot;: return local metadata immediately; no blocking network wait. If no local metadata exists, returns an empty list. If <code>refreshFromServer</code> is true (default), a background refresh runs to update the local cache.</li><li>&quot;network&quot;: block until the server responds (up to <code>serverTimeoutMs</code>, default 10000ms). If the client is explicitly offline, the call fails fast with code <code>LIST_UNAVAILABLE_OFFLINE</code>.</li><li>&quot;localIfAvailableElseNetwork&quot; (default): <ul><li>If any cached metadata exists, return it immediately and, when <code>refreshFromServer</code> is true, refresh in the background.</li><li>If no cached metadata exists, block on the server (like &quot;network&quot;).</li></ul></li></ul><p>Additional flags:</p><ul><li><code>includeRoot?: boolean</code>  include per-user root document(s) in the results. This strictly follows <code>waitForLoad</code>; it does not force a blocking network call.</li><li><code>refreshFromServer?: boolean</code> (default true unless <code>localOnly</code> is true)  controls whether a server request is made at all. Background refresh is only started when the primary flow returns immediately (i.e., it does not already block on network).</li><li><code>localOnly?: boolean</code>  short-circuits and returns only documents that have local data; no network access.</li><li><code>serverTimeoutMs?: number</code>  timeout for the blocking network path (when applicable).</li></ul><h3 id="pagination-and-tags" tabindex="-1">Pagination and tags <a class="header-anchor" href="#pagination-and-tags" aria-label="Permalink to Pagination and tags"></a></h3><ul><li>Paging params: <code>limit</code>, <code>cursor</code>, <code>forward</code>, <code>returnPage</code>. Default sort is by <code>grantedAt</code> (document permission grant time) descending; pass <code>forward: true</code> for ascending.</li><li><code>returnPage: true</code> returns <code>{ items, cursor }</code> (backward-compatible array when omitted). With <code>refreshFromServer: true</code>, a background page walker fetches the remaining pages and updates the cache/<code>documentMetadataChanged</code> events; set <code>refreshFromServer: false</code> if you only want the first page. Note: cursors come from server responses; local-only/local-first paths do not fabricate cursors or enforce <code>limit</code> sizinguse <code>returnPage: true</code> when you need a cursor even if data is cached. To synchronously walk all pages yourself, loop on <code>{ returnPage: true, limit, cursor }</code> until <code>cursor</code> is null. To hydrate the full cache in one call, use <code>client.syncMetadata({ scope: &quot;all&quot;, pageSize, includeRoot })</code> and then list with <code>refreshFromServer: false</code>.</li><li>Server page size defaults to 100 when <code>limit</code> is omitted; you can request smaller/larger pages within server limits.</li><li>Tag filtering: <code>tag: string</code> performs an exact-match filter server-side. Responses include <code>tags: string[]</code> and <code>grantedAt</code>; both are cached locally and usable offline (e.g., list + <code>tag</code> will be filtered from cache when offline/local-only). Root is also considered for tag queriesif you tag the root, it can appear in tag-filtered results even when the default list filters root out. When <code>refreshFromServer</code> is true with a tag, the client still fetches the full dataset in the background to keep the cache complete, then filters locally for the tag.</li><li>Tag CRUD: server endpoints exist (<code>POST /documents/:id/tags { tag }</code>, <code>DELETE /documents/:id/tags/:tag</code>) and document create accepts optional tags; the high-level client currently exposes tagging via HTTP helpers or <code>client.makeRequest</code>.</li></ul><p>Offline behavior:</p><ul><li>In explicit offline mode, &quot;network&quot; or the network leg of &quot;localIfAvailableElseNetwork&quot; fails fast with <code>LIST_UNAVAILABLE_OFFLINE</code>. &quot;local&quot; returns the local list (and skips background refresh).</li></ul><h2 id="local-first-document-creation-client-generated-ulids" tabindex="-1">Local-first Document Creation (Client-generated ULIDs) <a class="header-anchor" href="#local-first-document-creation-client-generated-ulids" aria-label="Permalink to Local-first Document Creation (Client-generated ULIDs)"></a></h2><p>Create documents locally-first with a client-generated ULID. The client returns metadata immediately and, when not <code>localOnly</code>, marks as a pending create that is auto-committed when online.</p><div class="language-typescript"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Local-first create (returns metadata)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">metadata</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> client.documents.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">create</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({ title: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Draft&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> });</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> id</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> metadata.documentId;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Optional: manual commit (default onExists: &quot;link&quot;)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> client.documents.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">commitOfflineCreate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(id, { onExists: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;link&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Start sync (if you opened with manual start)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> client.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">startNetworkSync</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(id);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Introspection</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> pending</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> client.documents.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">listPendingCreates</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> isPending</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> client.documents.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">isPendingCreate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(id);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> client.documents.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cancelPendingCreate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(id);</span></span></code></pre></div><p>Events: <code>pendingCreateCommitted</code>, <code>pendingCreateFailed</code> help drive UI state.</p><h2 id="root-documents" tabindex="-1">Root Documents <a class="header-anchor" href="#root-documents" aria-label="Permalink to Root Documents"></a></h2><p>Some apps use a per-user root document. The server always returns the root in list responses (unless tag-filtered), and the client caches it. By default <code>documents.list()</code> filters it out; pass <code>includeRoot: true</code> to surface it (works offline after its cached).</p><div class="language-typescript"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Exclude root (default)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> docs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> client.documents.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">list</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Include root document(s)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> all</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> client.documents.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">list</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({ includeRoot: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> });</span></span></code></pre></div><h2 id="behavior-changes" tabindex="-1">Behavior changes <a class="header-anchor" href="#behavior-changes" aria-label="Permalink to Behavior changes"></a></h2><ul><li><strong>Root documents listing</strong>: <code>documents.list()</code> excludes root docs by default. Opt-in with <code>{ includeRoot: true }</code>.</li><li><strong>Offline mode requests</strong>: When <code>networkMode</code> is <code>&quot;offline&quot;</code>, HTTP calls fail fast with code <code>OFFLINE</code>.</li><li><strong>Open options</strong>: <code>documents.open()</code> uses <code>{ waitForLoad, enableNetworkSync, retainLocal, availabilityWaitMs }</code>. Older options like <code>waitForPermission</code>, <code>offlineWritePolicy</code>, per-doc <code>offline</code>, <code>provisionalPermission</code>, and <code>startNetwork</code> are removed.</li><li><strong>Create return shape</strong>: <code>documents.create()</code> returns <code>{ metadata }</code> (no <code>Y.Doc</code>).</li><li><strong>Pending create events</strong>: <code>pendingCreateCommitted</code>/<code>pendingCreateFailed</code> only (no <code>pendingCreate</code> at creation time).</li><li><strong>Evict-all flag</strong>: <code>documents.evictAll({ onlySynced })</code> (replaces <code>onlyUnsynced</code>).</li></ul><h2 id="oauth-authentication" tabindex="-1">OAuth Authentication <a class="header-anchor" href="#oauth-authentication" aria-label="Permalink to OAuth Authentication"></a></h2><div class="language-typescript"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Check if OAuth is available</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> hasOAuth</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> client.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">checkOAuthAvailable</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (hasOAuth) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // Start OAuth flow (redirects to Google)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> client.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">startOAuthFlow</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Handle OAuth callback (in your callback page)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> urlParams</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> URLSearchParams</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(window.location.search);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> code</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> urlParams.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;code&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> state</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> urlParams.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;state&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Without constructing a client on the callback route:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { JsBaoClient } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;js-bao-wss-client&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (code </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> state) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  try</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> token</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> JsBaoClient.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">exchangeOAuthCode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      apiUrl: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">API_URL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      appId: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">APP_ID</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      code,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      state,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // Persist token in your auth store and initialize the client later</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // (example only; use your own secure storage strategy)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    localStorage.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setItem</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;jwt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, token);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (error) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;OAuth callback failed:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, error);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Later (e.g., after redirecting back to your app shell):</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { initializeClient } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;js-bao-wss-client&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> client</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> initializeClient</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  apiUrl: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">API_URL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  wsUrl: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">WS_URL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  appId: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">APP_ID</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  token,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  databaseConfig: { type: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;sqljs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Check authentication status</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (client.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">isAuthenticated</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;User is authenticated&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> token</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> client.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getToken</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Manually set token</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">client.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setToken</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;new-jwt-token&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><h2 id="document-management" tabindex="-1">Document Management <a class="header-anchor" href="#document-management" aria-label="Permalink to Document Management"></a></h2><h3 id="create-and-list-documents" tabindex="-1">Create and List Documents <a class="header-anchor" href="#create-and-list-documents" aria-label="Permalink to Create and List Documents"></a></h3><div class="language-typescript"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Create a new document (returns metadata)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">metadata</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> client.documents.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">create</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  title: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;My New Document&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Created document:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, metadata.documentId);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// List all documents user has access to</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> documents</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> client.documents.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">list</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Get document details (network)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> docInfo</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> client.documents.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(documentId);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Document:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, docInfo.title, docInfo.permission);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Update document (root titles cannot be changed)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> updatedDoc</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> client.documents.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">update</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(documentId, {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  title: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Updated Title&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Delete a document (offline/pending-create/not-found handled by local eviction)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Throws if the document is currently open unless you force-close it first</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> client.documents.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">delete</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(documentId, { forceCloseIfOpen: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// auto-closes if open</span></span></code></pre></div><h3 id="document-aliases" tabindex="-1">Document Aliases <a class="header-anchor" href="#document-aliases" aria-label="Permalink to Document Aliases"></a></h3><div class="language-typescript"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Create or update an app-scoped alias</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> client.documents.aliases.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  scope: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;app&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  aliasKey: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;home&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  documentId,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// User-scoped alias (defaults userId to the current user)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> client.documents.aliases.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  scope: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;user&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  aliasKey: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;current-draft&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  documentId,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Resolve an alias</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> alias</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> client.documents.aliases.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">resolve</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  scope: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;app&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  aliasKey: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;home&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Open a document via alias (same return shape as documents.open)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">doc</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> client.documents.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openAlias</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  scope: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;app&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  aliasKey: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;home&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// List aliases for a document (admin-only on the server)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> aliases</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> client.documents.aliases.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">listForDocument</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(documentId);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Delete an alias (no error if already missing)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> client.documents.aliases.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">delete</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({ scope: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;app&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, aliasKey: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;home&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> });</span></span></code></pre></div><h4 id="atomic-create-with-alias" tabindex="-1">Atomic Create with Alias <a class="header-anchor" href="#atomic-create-with-alias" aria-label="Permalink to Atomic Create with Alias"></a></h4><p>Create a document and alias in a single atomic operation. This is an <strong>online-only</strong> operation that only creates the document if the alias doesn&#39;t already exist:</p><div class="language-typescript"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Create document with app-scoped alias (requires admin/owner role)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> result</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> client.documents.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">createWithAlias</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  title: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Home Page&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  alias: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    scope: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;app&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    aliasKey: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;home&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(result.documentId); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// The created document ID</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(result.alias.aliasKey); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// &quot;home&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(result.alias.documentId); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Same as documentId</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Create document with user-scoped alias</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> userResult</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> client.documents.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">createWithAlias</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  title: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;My Draft&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  alias: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    scope: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;user&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    aliasKey: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;current-draft&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Attempting to create with existing alias throws HTTP 409</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">try</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> client.documents.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">createWithAlias</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    title: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Another Home&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    alias: { scope: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;app&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, aliasKey: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;home&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">} </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (err) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Alias already exists&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p><strong>Differences from separate <code>create()</code> + <code>aliases.set()</code>:</strong></p><ul><li> <strong>Atomic</strong>: Document is only created if alias doesn&#39;t exist</li><li> <strong>No race conditions</strong>: Server-side transaction ensures consistency</li><li> <strong>Cleaner error handling</strong>: Single 409 error if alias exists (no orphaned documents)</li><li> <strong>Online only</strong>: Requires network connection (no offline support)</li></ul><p>Use <code>createWithAlias()</code> when you need guaranteed uniqueness based on an alias (e.g., &quot;only one home page per app&quot;). Use regular <code>create()</code> + <code>aliases.set()</code> when offline support is needed or when the document should be created regardless of alias conflicts.</p><h3 id="manage-permissions" tabindex="-1">Manage Permissions <a class="header-anchor" href="#manage-permissions" aria-label="Permalink to Manage Permissions"></a></h3><div class="language-typescript"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Get document permissions</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> permissions</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> client.documents.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getPermissions</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(documentId);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">permissions.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">forEach</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">perm</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">perm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">email</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}: ${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">perm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">permission</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Grant permission to a user</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> client.documents.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">updatePermissions</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(documentId, {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  userId: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;user-123&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  permission: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;read-write&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// &#39;owner&#39; | &#39;read-write&#39; | &#39;reader&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Batch update permissions</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> client.documents.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">updatePermissions</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(documentId, {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  permissions: [</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    { userId: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;user-1&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, permission: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;read-write&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    { userId: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;user-2&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, permission: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;reader&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Remove permission</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> client.documents.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">removePermission</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(documentId, userId);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Validate access to a document</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> accessResult</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> client.documents.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">validateAccess</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(documentId);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (accessResult.hasAccess) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;User has access:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, accessResult.permission);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (accessResult.viaInvitation) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Access via invitation&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h2 id="blob-storage" tabindex="-1">Blob Storage <a class="header-anchor" href="#blob-storage" aria-label="Permalink to Blob Storage"></a></h2><p>Blobs are stored per document and inherit document permissions. The client exposes a <code>BlobsAPI</code> namespace under <code>documents</code>.</p><p>Access patterns:</p><div class="language-typescript"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> blobs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> client.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">document</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(documentId).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">blobs</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span></code></pre></div><h3 id="upload-a-blob" tabindex="-1">Upload a Blob <a class="header-anchor" href="#upload-a-blob" aria-label="Permalink to Upload a Blob"></a></h3><div class="language-typescript"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> data</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> TextEncoder</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">encode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;hello blob&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">blobId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">numBytes</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">contentType</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> blobs.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">upload</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(data, {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  filename: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;hello.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  contentType: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;text/plain&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  disposition: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;attachment&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// or &quot;inline&quot;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // sha256Base64?: optional; computed automatically if omitted</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span></code></pre></div><h4 id="alternate-single-step-helper" tabindex="-1">Alternate single-step helper <a class="header-anchor" href="#alternate-single-step-helper" aria-label="Permalink to Alternate single-step helper"></a></h4><div class="language-typescript"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Convenience wrapper that returns { blobId, numBytes }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">blobId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">numBytes</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> client</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">document</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(documentId)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">blobs</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">uploadFile</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> TextEncoder</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">encode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;hello alt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">), {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    filename: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;alt.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    contentType: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;text/plain&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  });</span></span></code></pre></div><h3 id="list-blobs-with-pagination" tabindex="-1">List Blobs (with pagination) <a class="header-anchor" href="#list-blobs-with-pagination" aria-label="Permalink to List Blobs (with pagination)"></a></h3><div class="language-typescript"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> page1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> client.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">document</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(documentId).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">blobs</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">list</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({ limit: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">page1.items.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">forEach</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">b</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(b.blobId, b.filename, b.size);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (page1.cursor) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> page2</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> blobs.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">list</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({ cursor: page1.cursor });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="get-blob-metadata" tabindex="-1">Get Blob Metadata <a class="header-anchor" href="#get-blob-metadata" aria-label="Permalink to Get Blob Metadata"></a></h3><div class="language-typescript"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> meta</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> client.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">document</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(documentId).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">blobs</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(blobId);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(meta.filename, meta.contentType, meta.size);</span></span></code></pre></div><h3 id="get-a-download-url" tabindex="-1">Get a Download URL <a class="header-anchor" href="#get-a-download-url" aria-label="Permalink to Get a Download URL"></a></h3><div class="language-typescript"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Returns a direct Worker URL (no presign). Add `disposition` to control attachment vs inline.</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> url</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> client</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">document</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(documentId)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">blobs</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">downloadUrl</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(blobId, { disposition: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;attachment&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> });</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// e.g., use in browser: window.location.href = url</span></span></code></pre></div><h3 id="delete-a-blob" tabindex="-1">Delete a Blob <a class="header-anchor" href="#delete-a-blob" aria-label="Permalink to Delete a Blob"></a></h3><div class="language-typescript"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> client.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">document</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(documentId).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">blobs</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">delete</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(blobId); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// { deleted: true }</span></span></code></pre></div><h3 id="read-cached-blobs-different-shapes" tabindex="-1">Read Cached Blobs (different shapes) <a class="header-anchor" href="#read-cached-blobs-different-shapes" aria-label="Permalink to Read Cached Blobs (different shapes)"></a></h3><div class="language-typescript"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> text</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> client.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">document</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(documentId).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">blobs</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">read</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(blobId, {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  as: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;text&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> arrayBuffer</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> client</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">document</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(documentId)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">blobs</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">read</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(blobId, { as: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;arrayBuffer&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> });</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> blobObj</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> client.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">document</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(documentId).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">blobs</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">read</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(blobId, {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  as: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;blob&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> bytes</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> client.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">document</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(documentId).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">blobs</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">read</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(blobId, {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  as: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;uint8array&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span></code></pre></div><ul><li>All reads hit the Cache API / IndexedDB cache when available.</li><li>Pass <code>forceRedownload: true</code> to refresh from the server even if cached.</li><li><code>disposition</code> mirrors the URL helper if you need server-side content handling hints.</li></ul><h3 id="prefetch-blobs-for-offline-use" tabindex="-1">Prefetch Blobs for Offline Use <a class="header-anchor" href="#prefetch-blobs-for-offline-use" aria-label="Permalink to Prefetch Blobs for Offline Use"></a></h3><div class="language-typescript"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> client.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">document</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(documentId).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">blobs</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">prefetch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">([blobA, blobB], {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  concurrency: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  forceRedownload: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span></code></pre></div><p>Prefetch downloads the bytes into the Cache API/IndexedDB store so subsequent <code>read()</code> calls succeed offline.</p><h3 id="inspect-control-the-upload-queue" tabindex="-1">Inspect / Control the Upload Queue <a class="header-anchor" href="#inspect-control-the-upload-queue" aria-label="Permalink to Inspect / Control the Upload Queue"></a></h3><div class="language-typescript"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> uploadsApi</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> client.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">document</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(documentId).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">blobs</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Queue status (includes in-flight + pending items)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">uploadsApi.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">uploads</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">forEach</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">task</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(task.blobId, task.status);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Pause/resume individual uploads</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">uploadsApi.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pauseUpload</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(blobId);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">uploadsApi.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">resumeUpload</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(blobId);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Pause or resume everything for this document</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">uploadsApi.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pauseAll</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">uploadsApi.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">resumeAll</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Global events (optional)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">client.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;blobs:upload-progress&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, ([</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">event</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(event.queueId, event.status, event.bytesTransferred);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">client.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;blobs:upload-completed&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, ([</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">event</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;done&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, event.queueId);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">client.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;blobs:queue-drained&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;all uploads complete&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">));</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Adjust concurrency at runtime (minimum 1)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">client.documents.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setUploadConcurrency</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Current concurrency:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, client.documents.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getUploadConcurrency</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">());</span></span></code></pre></div><h3 id="notes" tabindex="-1">Notes <a class="header-anchor" href="#notes" aria-label="Permalink to Notes"></a></h3><ul><li>The client automatically computes base64 SHA-256 if not provided.</li><li>Upload requires write-level permission (or admin/owner). Listing, metadata, and download require reader+.</li><li>Uploads are queued when offline; the manager processes up to 2 uploads in parallel when network conditions allow. Pass <code>forceRedownload</code> to <code>read</code>/<code>prefetch</code> for fresh server bytes.</li><li>Events (<code>blobs:*</code>) surface queue state for progress bars or toast notifications.</li><li>Client-side max upload size is not enforced in the SDK.</li></ul><h2 id="offline-blob-storage" tabindex="-1">Offline Blob Storage <a class="header-anchor" href="#offline-blob-storage" aria-label="Permalink to Offline Blob Storage"></a></h2><p>Blob storage is fully offline-aware:</p><ol><li><p><strong>Uploads while offline</strong></p><div class="language-typescript"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> client.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setNetworkMode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;offline&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">blobId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> client</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">document</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(documentId)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">blobs</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">upload</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> TextEncoder</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">encode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;draft&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">), {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    filename: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;draft.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    contentType: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;text/plain&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Inspect pending work</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(client.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">document</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(documentId).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">blobs</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">uploads</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">());</span></span></code></pre></div><ul><li>Bytes are written to the Cache API (browser) or kept in a short-lived in-memory map when caching is unavailable.</li><li>Queue entries persist in IndexedDB so refreshes or reconnects continue uploading.</li></ul></li><li><p><strong>Reads when offline</strong></p><div class="language-typescript"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> text</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> client.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">document</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(documentId).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">blobs</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">read</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(blobId, {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  as: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;text&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Works offline thanks to the cached bytes</span></span></code></pre></div></li><li><p><strong>Coming back online</strong></p><div class="language-typescript"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> client.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setNetworkMode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;online&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Queue processes automatically; listen to blobs:queue-drained for completion</span></span></code></pre></div></li><li><p><strong>Prefetch before going offline</strong></p><div class="language-typescript"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> client.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">document</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(documentId).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">blobs</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">prefetch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(importantBlobIds);</span></span></code></pre></div><p>Prefetched blobs remain available for subsequent offline <code>read()</code> calls.</p></li><li><p><strong>Retention</strong></p><ul><li>Set <code>retainLocal: false</code> on upload options to drop cached bytes after success while leaving metadata intact.</li><li><code>delete()</code> removes queue entries, cached bytes, and server objects by default.</li></ul></li></ol><h3 id="service-worker-integration" tabindex="-1">Service Worker Integration <a class="header-anchor" href="#service-worker-integration" aria-label="Permalink to Service Worker Integration"></a></h3><p><code>BlobManager</code> caches blob responses in the shared Cache API (<code>js-bao-blobs:&lt;appId&gt;:&lt;userId&gt;</code>) and now exposes helpers so UI code can coordinate with the service worker:</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> blobs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> client.documents.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">blobs</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(documentId);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">blobs.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">hasServiceWorkerControl</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">warn</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Service worker has not taken control yet&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> url</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> blobs.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">proxyUrl</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(blobId, {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  disposition: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;attachment&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  attachmentFilename: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;report.pdf&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">imageElement.src </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> url;</span></span></code></pre></div><p>The client now posts these messages for you (including <code>apiBaseUrl</code>, <code>cachePrefix</code>, and the current token). To opt out (and send custom payloads) set <code>serviceWorkerBridge: { enabled: false }</code> when constructing <code>JsBaoClient</code>. Apps that never register a service worker simply ignore the bridge while continuing to use the shared Cache API for <code>read()</code> calls.</p><p>To support <code>&lt;img&gt;</code>/<code>&lt;video&gt;</code> tags and other non-authenticated fetches, add a service worker handler for requests on the same origin that match <code>/app/{appId}/api/documents/{documentId}/blobs/{blobId}/download</code>. The handler should swap the origin to the API host provided in the bridge payload, attach auth headers, fall back to the network when needed, and mirror the Cache API used by the main thread. A complete example:</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// sw.js</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> STATE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  appId: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  userId: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  token: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  cachePrefix: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  globalAdminAppId: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  apiBaseUrl: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// In-memory metadata example; persist to IndexedDB if you need SW restarts to keep state.</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> BLOB_METADATA</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Map</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">self.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">addEventListener</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;message&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">event</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">type</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">payload</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> event.data </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">||</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {};</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">type </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">||</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> !</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">payload) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (type </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">===</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;jsBao:init&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    STATE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.appId </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> payload.appId </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">??</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> STATE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.appId;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    STATE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.userId </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> payload.userId </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">??</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> STATE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.userId;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    STATE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.cachePrefix </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> payload.blobs?.cachePrefix </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">??</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> STATE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.cachePrefix;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    STATE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.globalAdminAppId </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> payload.globalAdminAppId </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">??</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> STATE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.globalAdminAppId;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    STATE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.apiBaseUrl </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> payload.apiBaseUrl </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">??</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> STATE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.apiBaseUrl;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    STATE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.token </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> payload.auth?.token </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">??</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> STATE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.token;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (type </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">===</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;jsBao:tokenUpdated&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    STATE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.token </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> payload.token </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">??</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> STATE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.token;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">self.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">addEventListener</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;fetch&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">event</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> url</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> URL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(event.request.url);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> apiOrigin</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> STATE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.apiBaseUrl </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">??</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> self.location.origin;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (url.origin </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!==</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> apiOrigin) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">STATE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.appId) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">url.pathname.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">startsWith</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`/app/${</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">STATE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">appId</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}/api/documents/`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">url.pathname.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">includes</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/blobs/&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">url.pathname.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">endsWith</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/download&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  event.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">respondWith</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">handleProxy</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(event.request));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">async</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> handleProxy</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">request</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">STATE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.appId) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> fetch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(request);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> requestUrl</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> URL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(request.url);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> apiBase</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> STATE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.apiBaseUrl</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    ?</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> URL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">STATE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.apiBaseUrl)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    :</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> URL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(requestUrl.origin);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> upstreamUrl</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> URL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    `${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">requestUrl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">pathname</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">requestUrl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">search</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    apiBase.origin</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  );</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> canonicalKey</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> buildCanonicalKey</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(apiBase.origin, requestUrl.pathname);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> metadata</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> extractDispositionMetadata</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(requestUrl);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (metadata) {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    BLOB_METADATA</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(canonicalKey, metadata);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> headers</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Headers</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(request.headers);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">STATE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.token) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    headers.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Authorization&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`Bearer ${</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">STATE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">token</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">STATE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.globalAdminAppId) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    headers.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;X-Global-Admin-App-Id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">STATE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.globalAdminAppId);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> upstreamRequest</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Request</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(upstreamUrl.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">toString</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(), {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    method: request.method,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    headers,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    redirect: request.redirect,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    cache: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;no-store&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    credentials: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;omit&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    mode: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;cors&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> cacheName</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    STATE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.cachePrefix </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">??</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `js-bao-blobs:${</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">STATE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">appId</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}:${</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">STATE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">userId</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> cache</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> caches.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">open</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(cacheName);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> canonicalRequest</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Request</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(canonicalKey, { method: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;GET&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> });</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> effectiveMetadata</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> metadata </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">??</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> BLOB_METADATA</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(canonicalKey) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">??</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> cached</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> cache.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">match</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(canonicalRequest);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (cached) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> applyDisposition</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(cached, effectiveMetadata);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> upstream</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> fetch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(upstreamRequest);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">upstream.ok </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">||</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> request.method </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!==</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;GET&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> upstream;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> sanitized</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> stripDisposition</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(upstream);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  try</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> cache.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">put</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(canonicalRequest, sanitized.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">clone</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">());</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (err) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">warn</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;[SW] Failed to write blob cache entry&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, err);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> applyDisposition</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(sanitized, effectiveMetadata);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> buildCanonicalKey</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">origin</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">pathname</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> URL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(pathname, origin).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">toString</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> extractDispositionMetadata</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">url</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> disposition</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> url.searchParams.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;disposition&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">disposition) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> attachmentFilename</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    url.searchParams.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;attachmentFilename&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">??</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> undefined</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { disposition, attachmentFilename };</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> stripDisposition</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">response</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> headers</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Headers</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(response.headers);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  headers.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">delete</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Content-Disposition&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Response</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(response.body, {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    status: response.status,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    statusText: response.statusText,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    headers,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> applyDisposition</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">response</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">metadata</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">metadata) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> response;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> headers</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Headers</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(response.headers);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  headers.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">delete</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Content-Disposition&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (metadata.disposition </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">===</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;inline&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    headers.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Content-Disposition&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;inline&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (metadata.disposition </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">===</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;attachment&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> filename</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> metadata.attachmentFilename;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (filename) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      headers.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &quot;Content-Disposition&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        `attachment; filename=&quot;${</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sanitizeAsciiFilename</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          filename</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        )</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}&quot;; filename*=UTF-8&#39;&#39;${</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">encodeRFC5987</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">filename</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">)</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}`</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      );</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      headers.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Content-Disposition&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;attachment&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Response</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(response.body, {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    status: response.status,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    statusText: response.statusText,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    headers,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> sanitizeAsciiFilename</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">filename</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> filename.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">replace</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">[&quot;</span><span style="--shiki-light:#22863A;--shiki-light-font-weight:bold;--shiki-dark:#85E89D;--shiki-dark-font-weight:bold;">\\</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">]</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">g</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;_&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> encodeRFC5987</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> encodeURIComponent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(value)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">replace</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      /</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">[&#39;()*]</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">g</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">char</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `%${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">char</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">charCodeAt</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">toString</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">16</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">toUpperCase</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">()</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}`</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    )</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">replace</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;">%(7C</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;">60</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;">5E)</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">g</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">_</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">hex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `%${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">hex</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">toLowerCase</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">()</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>The canonical request uses only <code>origin + pathname</code>, so all disposition variants reuse the same cache entry. Metadata can live in memory (as shown) or in IndexedDB if you need to survive worker restarts. Because cached responses are stored without <code>Content-Disposition</code>, each hit reapplies headers based on the active request. Extend the sample with background eviction or cache versioning as needed.</p><h3 id="document-invitations" tabindex="-1">Document Invitations <a class="header-anchor" href="#document-invitations" aria-label="Permalink to Document Invitations"></a></h3><div class="language-typescript"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Create an invitation</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> invitation</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> client.documents.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">createInvitation</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  documentId,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  &quot;user@example.com&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  &quot;read-write&quot;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> // &#39;owner&#39; | &#39;read-write&#39; | &#39;reader&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Invitation created:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, invitation.invitationId);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// List all invitations for a document</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> invitations</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> client.documents.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">listInvitations</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(documentId);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Update an invitation (changes permission)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> updatedInvitation</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> client.documents.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">updateInvitation</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  documentId,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  &quot;user@example.com&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  &quot;reader&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Get specific invitation</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> inv</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> client.documents.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getInvitation</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  documentId,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  &quot;user@example.com&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Delete an invitation</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> client.documents.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">deleteInvitation</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(documentId, invitationId);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Accept or decline (invitee)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> client.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">document</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(documentId).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">acceptInvitation</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> client.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">document</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(documentId).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">declineInvitation</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(invitationId);</span></span></code></pre></div><h3 id="pending-document-invitations-for-the-current-user" tabindex="-1">Pending Document Invitations (for the current user) <a class="header-anchor" href="#pending-document-invitations-for-the-current-user" aria-label="Permalink to Pending Document Invitations (for the current user)"></a></h3><div class="language-typescript"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// List documents youve been invited to (pending, unexpired)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> pending</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> client.me.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pendingDocumentInvitations</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Each item includes a best-effort `document` block with metadata (title, tags, createdAt, lastModified, createdBy)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> inv</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> of</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> pending) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(inv.document?.title, inv.document?.tags);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="users" tabindex="-1">Users <a class="header-anchor" href="#users" aria-label="Permalink to Users"></a></h3><div class="language-typescript"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Look up basic profile info for a user in the current app (cached like `me`)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> user</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> client.users.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getBasic</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;u01H...&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(user.name, user.email, user.appRole);</span></span></code></pre></div><h3 id="invitation-events" tabindex="-1">Invitation events <a class="header-anchor" href="#invitation-events" aria-label="Permalink to Invitation events"></a></h3><p>The client emits a unified <code>invitation</code> event for real-time invitation changes delivered over the WebSocket. Payload:</p><ul><li><code>{ type: &quot;invitation&quot;; action: &quot;created&quot; | &quot;updated&quot; | &quot;cancelled&quot; | &quot;declined&quot;; invitationId; documentId; permission; title?; invitedBy?; invitedAt?; expiresAt?; document?: { title?; tags?; createdAt?; lastModified?; createdBy? } }</code></li></ul><p>Example:</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">client.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;invitation&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">evt</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">action</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">documentId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">invitationId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">permission</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">title</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> evt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;invitation event&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, action, documentId, invitationId, permission, title);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span></code></pre></div><p>Use this to refresh invitation lists or badge counts without polling.</p><h2 id="large-language-models-llm" tabindex="-1">Large Language Models (LLM) <a class="header-anchor" href="#large-language-models-llm" aria-label="Permalink to Large Language Models (LLM)"></a></h2><div class="language-typescript"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// List available models</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">models</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">defaultModel</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> client.llm.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">models</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Default model:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, defaultModel);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Basic chat</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> reply</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> client.llm.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">chat</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // model is optional; uses server default when omitted</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  messages: [</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    { role: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;system&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, content: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;You are a helpful assistant.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    { role: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;user&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, content: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Summarize: Collaborative editing with Yjs.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  temperature: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  max_tokens: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">512</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  reasoning: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    effort: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;medium&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    exclude: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(reply.content);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Chat with image attachment (base64-encoded PNG)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> imageBase64</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> loadImageAsBase64</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/path/to/screenshot.png&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> imageReply</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> client.llm.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">chat</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  messages: [</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      role: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;system&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      content: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;You analyze screenshots and respond helpfully.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    { role: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;user&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, content: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Describe what you see in this image.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  attachments: [</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      type: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;image&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      mime: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;image/png&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      base64: imageBase64,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(imageReply.content);</span></span></code></pre></div><h2 id="gemini" tabindex="-1">Gemini <a class="header-anchor" href="#gemini" aria-label="Permalink to Gemini"></a></h2><div class="language-typescript"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Text generation with optional structured output</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> result</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> client.gemini.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">generate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  messages: [</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      role: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;system&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      parts: [{ type: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;text&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, text: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Reply in JSON with keys title and summary.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      role: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;user&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      parts: [{ type: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;text&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, text: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Summarize collaborative editing with Yjs.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  structuredOutput: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    responseMimeType: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;application/json&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    responseJsonSchema: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      type: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;object&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      properties: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        title: { type: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;string&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        summary: { type: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;string&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      required: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;title&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;summary&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(result.message.parts[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">].text);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Multimodal prompt with inline image data</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> screenshot</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> loadImageAsBase64</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/path/to/screenshot.png&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> client.gemini.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">generate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  messages: [</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      role: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;user&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      parts: [</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        { type: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;text&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, text: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Describe this screenshot.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        { type: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;image&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, mimeType: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;image/png&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, base64Data: screenshot },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      ],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Raw passthrough using Google&#39;s payload schema</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> rawPayload</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  contents: [</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      role: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;user&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      parts: [</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          text: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Summarize this JSON.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          inline_data: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            mimeType: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;application/json&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            data: someBase64Json,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      ],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">};</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> rawResponse</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> client.gemini.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">generateRaw</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  model: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;models/gemini-2.5-flash&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  body: rawPayload,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(rawResponse.candidates?.[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]?.content);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Token usage estimation</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> tokens</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> client.gemini.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">countTokens</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  model: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;models/gemini-2.5-flash&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  messages: [{ role: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;user&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, parts: [{ type: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;text&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, text: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;How many tokens?&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }] }],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(tokens.totalTokens);</span></span></code></pre></div><h3 id="gemini-configuration-notes" tabindex="-1">Gemini Configuration &amp; Notes <a class="header-anchor" href="#gemini-configuration-notes" aria-label="Permalink to Gemini Configuration &amp; Notes"></a></h3><ul><li><code>client.gemini</code> proxies to Cloudflare worker routes: <ul><li><code>GET /gemini/models</code>  <code>client.gemini.models()</code></li><li><code>POST /gemini/generate</code>  <code>client.gemini.generate(...)</code></li><li><code>POST /gemini/count-tokens</code>  <code>client.gemini.countTokens(...)</code></li><li><code>POST /gemini/generate-raw</code>  <code>client.gemini.generateRaw({ model, body })</code> These endpoints run server-side, so browser clients never see Google credentials.</li></ul></li><li>Deployments must configure a Gemini key in the worker environment (<code>GEMINI_API_KEY</code>, <code>GEMINI_API_TOKEN</code>, or <code>GEMINI_KEY</code>). Optional helpers: <ul><li><code>GEMINI_DEFAULT_MODEL</code> (e.g. <code>models/gemini-2.5-flash</code>)</li><li><code>GEMINI_ALLOWED_MODELS</code> (comma-separated allowlist such as <code>models/gemini-2.5-flash,models/gemini-2.5-pro</code>).</li></ul></li><li>Inline multimodal content uses base64 <code>parts</code> (text, image, file). Large file uploads can be added later via the Gemini Files API; V1 augments prompts with base64-inlined payloads up to ~25MB.</li><li>Structured output leverages <code>generationConfig.responseMimeType</code> plus optional <code>responseSchema</code> / <code>responseJsonSchema</code> so Gemini can return deterministic JSON. The full server response is always available via the <code>raw</code> field when you need annotations or safety metadata.</li><li>Error handling surfaces <code>JsBaoError</code> with <code>code: &quot;GEMINI_ERROR&quot;</code>; the <code>details</code> property contains the raw upstream payload so you can log or render troubleshooting info.</li><li>See <code>.dev.local.example</code> for sample environment values and <code>docs/gemini-direct-plan.md</code> for architectural details.</li></ul><h2 id="integrations-api" tabindex="-1">Integrations API <a class="header-anchor" href="#integrations-api" aria-label="Permalink to Integrations API"></a></h2><p>Proxy HTTP calls through the tenant-specific integrations defined in the admin UI:</p><div class="language-typescript"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> response</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> client.integrations.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">call</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  integrationKey: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;weather-api&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  method: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;GET&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  path: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/current&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  query: { city: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;San Francisco&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  headers: { </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;X-Debug&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;true&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(response.status);     </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Upstream status code</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(response.body);       </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// JSON returned by the provider</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(response.traceId);    </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Proxy trace id (mirrors admin logs)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(response.durationMs); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Milliseconds spent in the worker</span></span></code></pre></div><ul><li><code>integrationKey</code>  slug chosen in the admin UI. Keys are per-app.</li><li><code>method</code>, <code>path</code>, <code>query</code>, <code>headers</code>, <code>body</code>  forwarded exactly as provided, but the worker enforces the integrations allowlisted methods/paths, forwarded headers/query params, max body size, and timeout.</li><li>Success responses include the upstream <code>status</code>, <code>headers</code>, <code>body</code>, optional <code>traceId</code>, and <code>durationMs</code>.</li></ul><h3 id="errors" tabindex="-1">Errors <a class="header-anchor" href="#errors" aria-label="Permalink to Errors"></a></h3><p><code>client.integrations.call</code> throws <code>JsBaoError</code> with rich codes:</p><ul><li><code>OFFLINE</code>  The SDK is forced offline (<code>networkMode = &quot;offline&quot;</code>).</li><li><code>ACCESS_DENIED</code>  Missing/expired JWT.</li><li><code>INTEGRATION_NOT_FOUND</code>  Integration removed/archived or typo in <code>integrationKey</code>.</li><li><code>INTEGRATION_SECRET_MISSING</code>  Admin hasnt uploaded credentials yet.</li><li><code>INTEGRATION_REQUEST_INVALID</code>  Method/path/query/body violate guard rails (<code>DISALLOWED_METHOD</code>, <code>REQUEST_BODY_TOO_LARGE</code>, etc.).</li><li><code>INTEGRATION_PROXY_FAILED</code>  Upstream timeout/5xx. Inspect <code>error.details.traceId</code> to correlate with admin logs.</li></ul><p>Example handler:</p><div class="language-typescript"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { isJsBaoError } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;js-bao-wss-client&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">try</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> client.integrations.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">call</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({ integrationKey: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;crm&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, method: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;POST&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, path: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/contacts&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, body: { email: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;hi&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">} </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (error) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">isJsBaoError</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(error)) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    switch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (error.code) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      case</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;INTEGRATION_NOT_FOUND&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        alert</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;This integration is not available. Contact your admin.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        break</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      case</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;INTEGRATION_SECRET_MISSING&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        alert</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Configuration incomplete. Try again later.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        break</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      case</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;INTEGRATION_REQUEST_INVALID&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Request violates integration config&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, error.details);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        break</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      case</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;INTEGRATION_PROXY_FAILED&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Upstream failed&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, error.details?.traceId);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        break</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      default</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        throw</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> error;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    throw</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> error;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h2 id="real-time-collaboration" tabindex="-1">Real-time Collaboration <a class="header-anchor" href="#real-time-collaboration" aria-label="Permalink to Real-time Collaboration"></a></h2><h3 id="open-and-edit-documents" tabindex="-1">Open and Edit Documents <a class="header-anchor" href="#open-and-edit-documents" aria-label="Permalink to Open and Edit Documents"></a></h3><div class="language-typescript"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> *</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> as</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Y </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;yjs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Open a document for real-time editing</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">doc</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">ydoc</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> client.documents.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">open</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(documentId, {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  waitForLoad: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;localIfAvailableElseNetwork&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  enableNetworkSync: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ydoc) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">throw</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;No local copy available and network required&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Get shared types from the Y.Doc</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> ytext</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ydoc.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getText</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;content&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> ymap</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ydoc.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getMap</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;metadata&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Listen for document changes</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ydoc.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;update&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">update</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Document updated locally or remotely&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Make changes to the document (only if not read-only)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">client.documents.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">isReadOnly</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(documentId)) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ytext.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">insert</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Hello, world!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ymap.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;title&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;My Document&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ymap.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;lastModified&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Date</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">toISOString</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">());</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Check document permission and read-only status</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> permission</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> client.documents.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getDocumentPermission</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(documentId);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;User permission:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, permission); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// &#39;owner&#39; | &#39;read-write&#39; | &#39;reader&#39; | &#39;admin&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (client.documents.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">isReadOnly</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(documentId)) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Document is read-only&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Check sync status</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (client.documents.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">isSynced</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(documentId)) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Document is synced with server&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Listen for sync events</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">client.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;sync&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, ({ </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">documentId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">synced</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`Document ${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">documentId</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">} sync status: ${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">synced</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Close document when done</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> client.documents.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">close</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(documentId);</span></span></code></pre></div><h2 id="document-to-model-mapping-orm-integration" tabindex="-1">Document-to-Model Mapping (ORM Integration) <a class="header-anchor" href="#document-to-model-mapping-orm-integration" aria-label="Permalink to Document-to-Model Mapping (ORM Integration)"></a></h2><p>The client provides APIs to route js-bao ORM queries to specific Y.Docs. This allows you to work with multiple documents simultaneously while maintaining clear model-to-document associations.</p><h3 id="basic-concepts" tabindex="-1">Basic Concepts <a class="header-anchor" href="#basic-concepts" aria-label="Permalink to Basic Concepts"></a></h3><ul><li><strong>Model mapping</strong>: Explicitly routes a specific model class to a specific document</li><li><strong>Default document</strong>: Fallback document for models without explicit mappings</li><li><strong>Resolution hierarchy</strong>: Model mapping  Default document  Error</li></ul><h3 id="setting-a-default-document" tabindex="-1">Setting a Default Document <a class="header-anchor" href="#setting-a-default-document" aria-label="Permalink to Setting a Default Document"></a></h3><p>Use <code>setDefaultDocumentId()</code> to establish a fallback document for all unmapped models:</p><div class="language-typescript"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Open a document first (required)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">doc</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> client.documents.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">open</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;my-default-doc&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Set it as the default for unmapped models</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">client.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setDefaultDocumentId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;my-default-doc&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Now any model without an explicit mapping will use this document</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// e.g., Contact.query()  runs against &#39;my-default-doc&#39;</span></span></code></pre></div><p><strong>Important</strong>: Documents must be open before setting as default. The method throws if the document isn&#39;t already open.</p><h3 id="mapping-specific-models" tabindex="-1">Mapping Specific Models <a class="header-anchor" href="#mapping-specific-models" aria-label="Permalink to Mapping Specific Models"></a></h3><p>Use <code>addDocumentModelMapping()</code> to route individual models to specific documents:</p><div class="language-typescript"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Open the documents you want to use</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> client.documents.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">open</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;users-doc&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> client.documents.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">open</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;tasks-doc&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Map specific models</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">client.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">addDocumentModelMapping</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Contact&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;users-doc&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">client.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">addDocumentModelMapping</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Task&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;tasks-doc&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Now queries route correctly:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Contact.query()  uses &#39;users-doc&#39;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Task.query()  uses &#39;tasks-doc&#39;</span></span></code></pre></div><h3 id="complete-example-multi-document-application" tabindex="-1">Complete Example: Multi-Document Application <a class="header-anchor" href="#complete-example-multi-document-application" aria-label="Permalink to Complete Example: Multi-Document Application"></a></h3><div class="language-typescript"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { initializeClient } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;js-bao-wss-client&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { Contact, Task, Note } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;./models&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">async</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> setupModels</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> client</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> initializeClient</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    apiUrl: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;https://api.example.com&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    wsUrl: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;wss://ws.example.com&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    appId: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;my-app&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    token: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;jwt-token&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    databaseConfig: { type: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;sqljs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 1. Open all documents you&#39;ll be using</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> usersDoc</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> client.documents.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">open</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;users-doc-123&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> tasksDoc</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> client.documents.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">open</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;tasks-doc-456&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> generalDoc</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> client.documents.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">open</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;general-doc-789&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 2. Set default document for unmapped models</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  client.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setDefaultDocumentId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;general-doc-789&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 3. Map specific models to their documents</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  client.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">addDocumentModelMapping</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Contact&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;users-doc-123&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  client.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">addDocumentModelMapping</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Task&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;tasks-doc-456&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // Note has no mapping, so it will use the default document</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 4. Now ORM queries route automatically:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> contacts</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Contact.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">query</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//  users-doc-123</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> tasks</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Task.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">query</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//  tasks-doc-456</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> notes</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Note.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">query</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//  general-doc-789 (default)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 5. Verify current mappings</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> contactDocId</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> client.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getDocumentModelMapping</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Contact&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Contact uses:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, contactDocId); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// &#39;users-doc-123&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> defaultDocId</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> client.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getDefaultDocumentId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Default doc:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, defaultDocId); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// &#39;general-doc-789&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { client, usersDoc, tasksDoc, generalDoc };</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> setupModels</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span></code></pre></div><h3 id="updating-mappings" tabindex="-1">Updating Mappings <a class="header-anchor" href="#updating-mappings" aria-label="Permalink to Updating Mappings"></a></h3><p>You can change mappings at runtime:</p><div class="language-typescript"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Switch Contact to a different document</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> client.documents.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">open</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;contacts-v2-doc&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">client.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">addDocumentModelMapping</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Contact&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;contacts-v2-doc&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Clear a specific mapping (falls back to default document)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">client.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">clearDocumentModelMapping</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Contact&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Change the default document</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> client.documents.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">open</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;new-default-doc&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">client.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setDefaultDocumentId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;new-default-doc&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Clear the default (models without mappings will error)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">client.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">clearDefaultDocumentId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span></code></pre></div><h3 id="querying-current-configuration" tabindex="-1">Querying Current Configuration <a class="header-anchor" href="#querying-current-configuration" aria-label="Permalink to Querying Current Configuration"></a></h3><div class="language-typescript"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Check what document a model is using</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> taskDocId</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> client.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getDocumentModelMapping</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Task&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (taskDocId) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Task model uses document:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, taskDocId);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">} </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Task model has no explicit mapping&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Check the default document</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> defaultId</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> client.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getDefaultDocumentId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (defaultId) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Default document:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, defaultId);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">} </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;No default document set&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// List all currently open documents</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> openDocs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> client.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">listOpenDocuments</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Open documents:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, openDocs);</span></span></code></pre></div><h3 id="best-practices" tabindex="-1">Best Practices <a class="header-anchor" href="#best-practices" aria-label="Permalink to Best Practices"></a></h3><ol><li><strong>Open before mapping</strong>: Always open documents before setting them as default or mapping models to them</li><li><strong>Set default first</strong>: Establish a default document before adding specific mappings to avoid errors</li><li><strong>Organize by domain</strong>: Group related models in the same document (e.g., all user-related models in one doc)</li><li><strong>Document lifecycle</strong>: Clear mappings when closing documents to avoid stale references</li><li><strong>Multi-tenant apps</strong>: Use different document mappings per tenant/workspace</li></ol><h3 id="error-handling" tabindex="-1">Error Handling <a class="header-anchor" href="#error-handling" aria-label="Permalink to Error Handling"></a></h3><div class="language-typescript"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">try</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // This will throw if the document isn&#39;t open</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  client.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setDefaultDocumentId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;not-open-yet&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">} </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (error) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Document must be open first&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">try</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // This will throw if no mapping or default exists</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> UnmappedModel.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">query</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">} </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (error) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;No document mapping for this model&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="use-case-workspace-switching" tabindex="-1">Use Case: Workspace Switching <a class="header-anchor" href="#use-case-workspace-switching" aria-label="Permalink to Use Case: Workspace Switching"></a></h3><div class="language-typescript"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">async</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> switchWorkspace</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">workspaceId</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // Open the workspace&#39;s document</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">doc</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> client.documents.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">open</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(workspaceId);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // Update all model mappings to this workspace</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  client.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setDefaultDocumentId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(workspaceId);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  client.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">addDocumentModelMapping</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Task&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, workspaceId);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  client.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">addDocumentModelMapping</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Note&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, workspaceId);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  client.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">addDocumentModelMapping</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Contact&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, workspaceId);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // All subsequent queries now use the new workspace&#39;s document</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> tasks</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Task.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">query</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//  reads from workspaceId</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="use-case-per-model-documents" tabindex="-1">Use Case: Per-Model Documents <a class="header-anchor" href="#use-case-per-model-documents" aria-label="Permalink to Use Case: Per-Model Documents"></a></h3><div class="language-typescript"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Organize models by type across different documents</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">await</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Promise</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">all</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">([</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  client.documents.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">open</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;people-doc&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  client.documents.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">open</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;projects-doc&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  client.documents.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">open</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;calendar-doc&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Set up routing</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">client.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">addDocumentModelMapping</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Contact&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;people-doc&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">client.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">addDocumentModelMapping</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Company&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;people-doc&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">client.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">addDocumentModelMapping</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Project&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;projects-doc&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">client.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">addDocumentModelMapping</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Task&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;projects-doc&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">client.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">addDocumentModelMapping</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Event&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;calendar-doc&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">client.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">addDocumentModelMapping</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Reminder&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;calendar-doc&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// No default needed - all models are explicitly mapped</span></span></code></pre></div><h2 id="awareness-user-presence" tabindex="-1">Awareness (User Presence) <a class="header-anchor" href="#awareness-user-presence" aria-label="Permalink to Awareness (User Presence)"></a></h2><p>The JsBaoClient provides two awareness APIs. Use the DocumentsAPI methods for convenience:</p><div class="language-typescript"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Set your awareness state (cursor, selection, user info) - Convenience API</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">client.documents.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setAwareness</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(documentId, {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  user: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    name: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;John Doe&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    email: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;john@example.com&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    color: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;#ff0000&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  cursor: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    line: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    column: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  selection: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    start: { line: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, column: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    end: { line: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, column: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">12</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Get all awareness states - Convenience API</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> awarenessStates</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> client.documents.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getAwarenessStates</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(documentId);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">awarenessStates.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">forEach</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">state</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">clientId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`Client ${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">clientId</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}:`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, state.user?.name, state.cursor);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Advanced awareness API for more control</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">client.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setLocalAwarenessState</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(documentId, {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  user: { name: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Jane Doe&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, color: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;#00ff00&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  cursor: { line: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, column: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Listen for awareness changes</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">client.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;awareness&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, ({ </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">documentId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">added</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">updated</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">removed</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`Awareness changed for ${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">documentId</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Added clients:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, added);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Updated clients:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, updated);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Removed clients:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, removed);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span></code></pre></div><h2 id="user-profile-and-session" tabindex="-1">User Profile and Session <a class="header-anchor" href="#user-profile-and-session" aria-label="Permalink to User Profile and Session"></a></h2><div class="language-typescript"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Get current user profile</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> profile</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> client.me.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;User:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, profile.name, profile.email);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;App role:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, profile.appRole);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;User ID:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, profile.userId);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Get session information</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> session</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> client.session.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Session ID:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, session.sessionId);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Session expires:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, session.expiresAt);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Last activity:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, session.lastActivity);</span></span></code></pre></div><h2 id="error-handling-1" tabindex="-1">Error Handling <a class="header-anchor" href="#error-handling-1" aria-label="Permalink to Error Handling"></a></h2><div class="language-typescript"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">try</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // HTTP operations throw exceptions</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> res</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> client.documents.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">create</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({ title: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Test&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">} </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (error) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ((error </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">as</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> any</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">).message?.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">includes</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;401&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Authentication failed&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ((error </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">as</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> any</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">).message?.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">includes</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;403&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Permission denied&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ((error </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">as</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> any</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">).code </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">===</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;OFFLINE&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Client offline&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;API error:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, (error </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">as</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> any</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">).message);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// WebSocket errors are handled via events</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">client.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;connection-error&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;WebSocket error:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, error);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">client.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;auth-failed&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, ({ </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">message</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Auth failed:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, message);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // Refresh token or redirect to login</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span></code></pre></div><h2 id="token-management" tabindex="-1">Token Management <a class="header-anchor" href="#token-management" aria-label="Permalink to Token Management"></a></h2><div class="language-typescript"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Refresh token when it expires</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">client.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">refreshToken</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;newJwtToken&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Handle auth failures</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">client.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;auth-failed&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">async</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ({ </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">message</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  try</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // Get new token from your auth system</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> newToken</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> refreshAuthToken</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    client.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">refreshToken</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(newToken);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (error) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // Redirect to login page</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    window.location.href </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;/login&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Manual token management</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">client.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setToken</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;new-jwt-token&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Also calls refreshToken internally</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> currentToken</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> client.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getToken</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> isAuthenticated</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> client.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">isAuthenticated</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span></code></pre></div><h2 id="connection-management" tabindex="-1">Connection Management <a class="header-anchor" href="#connection-management" aria-label="Permalink to Connection Management"></a></h2><div class="language-typescript"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Check connection status</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (client.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">isConnected</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;WebSocket is connected&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Check document sync status</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (client.documents.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">isSynced</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(documentId)) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Document is synced&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Manually control connection (returns Promise)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> client.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setShouldConnect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Disconnect</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> client.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setShouldConnect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Reconnect</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Manual disconnect (returns Promise)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> client.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">disconnect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Clean up when done (closes all documents and connections)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> client.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">destroy</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span></code></pre></div><h2 id="logout-offline-identity-and-offline-grant-discovery" tabindex="-1">Logout, Offline Identity, and Offline Grant Discovery <a class="header-anchor" href="#logout-offline-identity-and-offline-grant-discovery" aria-label="Permalink to Logout, Offline Identity, and Offline Grant Discovery"></a></h2><p>The client provides a unified <code>logout</code> that clears the server refresh cookie (best-effort), shuts down networking, and resets in-memory auth. Apps can control how offline capability behaves post-logout.</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> client.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">logout</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  redirectTo: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/login&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// optional redirect</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  wipeLocal: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// if true, evict local document caches</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  revokeOffline: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// if true, delete the stored offline grant</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  clearOfflineIdentity: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// default true; if false, keep in-memory offlineIdentity</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span></code></pre></div><ul><li>If <code>clearOfflineIdentity</code> is <code>true</code> (default): the client clears the in-memory <code>offlineIdentity</code> during logout so the instance is not considered authenticated until the user explicitly unlocks offline.</li><li>If <code>clearOfflineIdentity</code> is <code>false</code>: the client keeps the in-memory <code>offlineIdentity</code>. This can be desirable in apps that want the offline persona to remain available immediately after sign out.</li></ul><p>Offline grant persistence and discovery:</p><ul><li>Enabling or unlocking offline stores a signed grant in a user-scoped IndexedDB database named <code>js-bao:offline:{appId}:{userId}</code>.</li><li>The client remembers the last offline-capable user id in <code>localStorage</code> under <code>js-bao:last-user:{appId}</code>.</li><li><code>hasOfflineGrantStored()</code> detects grants even after logout by discovering the last user via <code>localStorage</code> or (when available) enumerating <code>indexedDB.databases()</code>.</li></ul><h2 id="client-managed-auth-orchestration" tabindex="-1">Client-managed Auth Orchestration <a class="header-anchor" href="#client-managed-auth-orchestration" aria-label="Permalink to Client-managed Auth Orchestration"></a></h2><p>New client options:</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> client</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> initializeClient</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // ...</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  autoOAuth: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// auto-start OAuth if still unauthenticated</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  oauthRedirectUri, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// required when autoOAuth is true</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  suppressAutoLoginMs: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">5000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// suppress silent refresh/OAuth for ~5s after logout</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  autoUnlockOfflineOnInit: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// when offline and a grant exists, unlock at startup</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  databaseConfig: { type: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;sqljs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span></code></pre></div><p>Behavior at startup (when no token):</p><ul><li>If <code>autoUnlockOfflineOnInit</code> and device is offline and a grant exists, the client unlocks offline, opens user-scoped IndexedDB (metadata + offline), and emits <code>offlineAuth:unlocked</code>.</li><li>Otherwise, if not within <code>suppressAutoLoginMs</code>, the client attempts a silent cookie refresh to mint a JWT.</li><li>If still unauthenticated and <code>autoOAuth</code> is true, the client auto-starts OAuth.</li></ul><p>Ongoing refresh:</p><ul><li>The client proactively refreshes tokens before expiry and retries once on <code>401</code> before emitting <code>auth-failed</code>.</li></ul><p>Apps should subscribe to events (<code>auth-success</code>, <code>auth-failed</code>, <code>offlineAuth:unlocked</code>) to mirror session state into their UI/store.</p><h2 id="complete-example-collaborative-text-editor" tabindex="-1">Complete Example: Collaborative Text Editor <a class="header-anchor" href="#complete-example-collaborative-text-editor" aria-label="Permalink to Complete Example: Collaborative Text Editor"></a></h2><div class="language-typescript"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { JsBaoClient, initializeClient } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;js-bao-wss-client&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> *</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> as</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Y </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;yjs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> CollaborativeEditor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  private</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> client</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> JsBaoClient</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  private</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> ydoc</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Y</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Doc</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  private</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> ytext</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Y</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Text</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  static</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> async</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> create</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">    apiUrl</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">    wsUrl</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">    appId</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">    token</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  )</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Promise</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">CollaborativeEditor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> client</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> initializeClient</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      apiUrl,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      wsUrl,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      appId,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      token,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      databaseConfig: { type: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;sqljs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      autoOAuth: </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">token,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      oauthRedirectUri: window.location.origin </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;/oauth/callback&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    });</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> editor</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> CollaborativeEditor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    editor.client </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> client;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    editor.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setupEventListeners</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> editor;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  private</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> constructor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  private</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> setupEventListeners</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // Connection status</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.client.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;status&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, ({ </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">status</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">updateConnectionUI</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(status);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // Document sync</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.client.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;sync&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, ({ </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">documentId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">synced</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">updateSyncUI</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(synced);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // User awareness</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.client.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;awareness&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, ({ </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">documentId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">added</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">updated</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">removed</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">updateCursors</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(added, updated, removed);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // Auth events</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.client.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;auth-failed&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">handleAuthFailure</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  async</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> createDocument</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">title</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">metadata</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.client.documents.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">create</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({ title });</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> metadata.documentId;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  async</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> openDocument</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">documentId</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // Open for real-time editing</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">doc</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.client.documents.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">open</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(documentId, {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      waitForLoad: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;localIfAvailableElseNetwork&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      enableNetworkSync: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    });</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.ydoc </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> doc </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">as</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Y</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Doc</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.ytext </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.ydoc.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getText</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;content&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // Listen for text changes</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.ytext.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">observe</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">event</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">updateEditorContent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // Set initial awareness</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.client.documents.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setAwareness</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(documentId, {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      user: { name: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Current User&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, color: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;#0066cc&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      cursor: { line: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, column: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // Check if read-only</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.client.documents.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">isReadOnly</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(documentId)) {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setEditorReadOnly</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.ytext;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  insertText</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">index</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> number</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">text</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">formatting</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> any</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.ytext </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;&amp;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      !</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.client.documents.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">isReadOnly</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getCurrentDocumentId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">())</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ) {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.ytext.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">insert</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(index, text, formatting);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  deleteText</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">index</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> number</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">length</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> number</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.ytext </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;&amp;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      !</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.client.documents.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">isReadOnly</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getCurrentDocumentId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">())</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ) {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.ytext.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">delete</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(index, length);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  updateCursor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">line</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> number</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">column</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> number</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">documentId</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.client.documents.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setAwareness</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(documentId, {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      user: { name: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Current User&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, color: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;#0066cc&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      cursor: { line, column },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  async</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> inviteUser</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">    documentId</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">    email</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">    permission</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;read-write&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;reader&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    try</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> invitation</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.client.documents.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">createInvitation</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        documentId,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        email,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        permission</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      );</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Invitation sent:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, invitation.invitationId);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> invitation;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (error) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Failed to invite user:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, error);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      throw</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> error;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  private</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> updateConnectionUI</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">status</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // Update your UI to show connection status</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Connection:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, status);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  private</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> updateSyncUI</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">synced</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> boolean</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // Update your UI to show sync status</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Synced:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, synced);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  private</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> updateCursors</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">added</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[], </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">updated</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[], </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">removed</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[]) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // Update cursor display in your editor</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Cursors changed:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, { added, updated, removed });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  private</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> updateEditorContent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // Update your editor&#39;s display</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.ytext) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> content</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.ytext.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">toString</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Content updated:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, content);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  private</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> setEditorReadOnly</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">readOnly</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> boolean</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // Set your editor to read-only mode</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Editor read-only:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, readOnly);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  private</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> handleAuthFailure</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // Handle authentication failure</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.client.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">checkOAuthAvailable</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()) {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.client.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">startOAuthFlow</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      // Redirect to custom login</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      window.location.href </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;/login&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  private</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> getCurrentDocumentId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // Return current document ID</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;current-doc-id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  async</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> closeDocument</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">documentId</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.client.documents.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">close</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(documentId);</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.ydoc </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.ytext </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  async</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> destroy</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    await</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.client.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">destroy</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Usage</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> editor</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> CollaborativeEditor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  &quot;https://api.example.com&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  &quot;wss://ws.example.com&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  &quot;my-app-id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  &quot;optional-jwt-token&quot;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> // Omit for OAuth flow</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Create and open a document</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> documentId</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> editor.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">createDocument</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;My Collaborative Doc&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> ytext</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> editor.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openDocument</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(documentId);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Make some edits</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">editor.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">insertText</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Hello, collaborative world!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Invite a user</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> editor.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">inviteUser</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(documentId, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;colleague@example.com&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;read-write&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><h2 id="best-practices-1" tabindex="-1">Best Practices <a class="header-anchor" href="#best-practices-1" aria-label="Permalink to Best Practices"></a></h2><ol><li><strong>Always handle auth failures</strong>: Set up proper token refresh logic or OAuth flow</li><li><strong>Listen for sync events</strong>: Don&#39;t assume documents are immediately synced</li><li><strong>Clean up resources</strong>: Call <code>documents.close()</code> on documents and <code>destroy()</code> on client</li><li><strong>Use awareness wisely</strong>: Update cursor/selection frequently but throttle updates</li><li><strong>Handle network issues</strong>: The client auto-reconnects, but update your UI accordingly</li><li><strong>Batch operations</strong>: Use batch permission updates when possible</li><li><strong>Check permissions</strong>: Use <code>validateAccess()</code> and <code>isReadOnly()</code> before making changes</li><li><strong>Use invitations</strong>: Invite users via email instead of requiring user IDs</li></ol><h2 id="typescript-support" tabindex="-1">TypeScript Support <a class="header-anchor" href="#typescript-support" aria-label="Permalink to TypeScript Support"></a></h2><p>The library is written in TypeScript and provides full type definitions for all APIs, events, and data structures.</p><h2 id="local-development-testing" tabindex="-1">Local Development &amp; Testing <a class="header-anchor" href="#local-development-testing" aria-label="Permalink to Local Development &amp; Testing"></a></h2><p>For contributors and developers working on this package:</p><h3 id="testing-locally" tabindex="-1">Testing Locally <a class="header-anchor" href="#testing-locally" aria-label="Permalink to Testing Locally"></a></h3><p>See <a href="./_media/LOCAL_TESTING.html">LOCAL_TESTING.md</a> for a comprehensive guide on testing your changes locally using <code>npm pack</code>.</p><p><strong>Quick test:</strong></p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">npm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> build</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &amp;&amp; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">npm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pack</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ../../../</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &amp;&amp; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mkdir</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> test-package</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &amp;&amp; </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> test-package</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">npm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> init</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -y</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &amp;&amp; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">npm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ../js-bao-wss/src/client/js-bao-wss-client-1.0.0.tgz</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">echo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;import {JsBaoClient} from &quot;js-bao-wss-client&quot;; console.log(&quot; Works!&quot;)&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> test.js</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sed</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -i</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;&#39;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;s/&quot;type&quot;: &quot;commonjs&quot;/&quot;type&quot;: &quot;module&quot;/&#39;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> package.json</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &amp;&amp; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">node</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> test.js</span></span></code></pre></div><h3 id="running-built-in-tests" tabindex="-1">Running Built-in Tests <a class="header-anchor" href="#running-built-in-tests" aria-label="Permalink to Running Built-in Tests"></a></h3><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tests</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">npm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">npm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> test:esm</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     # Test ESM imports</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">npm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> test:umd</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     # Instructions for UMD testing</span></span></code></pre></div><h3 id="build-commands" tabindex="-1">Build Commands <a class="header-anchor" href="#build-commands" aria-label="Permalink to Build Commands"></a></h3><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">npm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> build</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # Build both ESM and UMD</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">npm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> build:esm</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # Build ESM only</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">npm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> build:umd</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # Build UMD only</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">npm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pack</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">             # Create publishable package</span></span></code></pre></div></div></div></main><footer class="VPDocFooter" data-v-f13de798 data-v-d2200dbb><!--[--><!--]--><!----><nav class="prev-next" aria-labelledby="doc-footer-aria-label" data-v-d2200dbb><span class="visually-hidden" id="doc-footer-aria-label" data-v-d2200dbb>Pager</span><div class="pager" data-v-d2200dbb><!----></div><div class="pager" data-v-d2200dbb><a class="VPLink link pager-link next" href="/primitive-docs/getting-started/page-1.html" data-v-d2200dbb><!--[--><span class="desc" data-v-d2200dbb>Next page</span><span class="title" data-v-d2200dbb>Page 1</span><!--]--></a></div></nav></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><!----><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"api-examples.md\":\"SgZ_k4fn\",\"getting-started_page-1.md\":\"BOHEJWZg\",\"getting-started_page-2.md\":\"2d4rktsq\",\"guide_getting-started.md\":\"DV_JPq3P\",\"guide_index.md\":\"CkrNIPH9\",\"index.md\":\"juLpQBEu\",\"markdown-examples.md\":\"DJQnVTz0\",\"reference_index.md\":\"B59HKR0q\",\"reference_js-bao-wss-client_api__media_local_testing.md\":\"DGmQI_YG\",\"reference_js-bao-wss-client_api_classes_jsbaoclient.md\":\"D0hSsPTw\",\"reference_js-bao-wss-client_api_classes_jsbaoerror.md\":\"BFGl4KGV\",\"reference_js-bao-wss-client_api_functions_initializeclient.md\":\"DoFI5Rph\",\"reference_js-bao-wss-client_api_functions_isjsbaoerror.md\":\"CY4SCbop\",\"reference_js-bao-wss-client_api_globals.md\":\"DR-rF2VF\",\"reference_js-bao-wss-client_api_interfaces_analyticsautoeventsoptions.md\":\"CNsAgNA_\",\"reference_js-bao-wss-client_api_interfaces_analyticsclient.md\":\"BYjoZ2c9\",\"reference_js-bao-wss-client_api_interfaces_analyticseventinput.md\":\"CZ2ntkYT\",\"reference_js-bao-wss-client_api_interfaces_authstateevent.md\":\"BXPArKjL\",\"reference_js-bao-wss-client_api_interfaces_basicuserinfo.md\":\"D811haSZ\",\"reference_js-bao-wss-client_api_interfaces_blobuploadcompletedevent.md\":\"CWRK947i\",\"reference_js-bao-wss-client_api_interfaces_blobuploadfailedevent.md\":\"t_nfKc4F\",\"reference_js-bao-wss-client_api_interfaces_blobuploadprogressevent.md\":\"BJG36DSs\",\"reference_js-bao-wss-client_api_interfaces_cachefacade.md\":\"DT1n3Kek\",\"reference_js-bao-wss-client_api_interfaces_documentaccessresult.md\":\"DA9vCRnA\",\"reference_js-bao-wss-client_api_interfaces_documentcreatecommitfailedevent.md\":\"aP2EFxs-\",\"reference_js-bao-wss-client_api_interfaces_documentevent.md\":\"Ct9nniD3\",\"reference_js-bao-wss-client_api_interfaces_documentinfo.md\":\"GHfcroA2\",\"reference_js-bao-wss-client_api_interfaces_documentinvitation.md\":\"BXFGDkPF\",\"reference_js-bao-wss-client_api_interfaces_documentinvitationresponse.md\":\"0jXnIFKh\",\"reference_js-bao-wss-client_api_interfaces_documentmetadatachangedevent.md\":\"DLMFHcpz\",\"reference_js-bao-wss-client_api_interfaces_documentpermissionentry.md\":\"DCVN5hQb\",\"reference_js-bao-wss-client_api_interfaces_geminigeneraterawoptions.md\":\"DcJmDjIn\",\"reference_js-bao-wss-client_api_interfaces_geminigenerateresult.md\":\"ClduLlj2\",\"reference_js-bao-wss-client_api_interfaces_geminimessage.md\":\"dlgVxFQw\",\"reference_js-bao-wss-client_api_interfaces_geminimodelsummary.md\":\"DTd6wOQz\",\"reference_js-bao-wss-client_api_interfaces_geminipromptoptions.md\":\"CheRfKyO\",\"reference_js-bao-wss-client_api_interfaces_geministructuredoutput.md\":\"a9ZgQMLl\",\"reference_js-bao-wss-client_api_interfaces_integrationcallrequest.md\":\"V8Q5fn9q\",\"reference_js-bao-wss-client_api_interfaces_integrationcallresponse.md\":\"mfvkHzZp\",\"reference_js-bao-wss-client_api_interfaces_integrationsapi.md\":\"9GzTp9SM\",\"reference_js-bao-wss-client_api_interfaces_invitationevent.md\":\"CQ7jcOKp\",\"reference_js-bao-wss-client_api_interfaces_jsbaoclientoptions.md\":\"B5jiSh9x\",\"reference_js-bao-wss-client_api_interfaces_jsbaoevents.md\":\"CTEcvTDl\",\"reference_js-bao-wss-client_api_interfaces_llmchatoptions.md\":\"CynZV1ys\",\"reference_js-bao-wss-client_api_interfaces_meupdatedevent.md\":\"YkzohiiY\",\"reference_js-bao-wss-client_api_interfaces_meupdatefailedevent.md\":\"CSyRaqNp\",\"reference_js-bao-wss-client_api_interfaces_networkmodeevent.md\":\"BIXlIEnw\",\"reference_js-bao-wss-client_api_interfaces_offlineauthenabledevent.md\":\"2uFENiOL\",\"reference_js-bao-wss-client_api_interfaces_offlineauthexpiringsoonevent.md\":\"CoINnUFR\",\"reference_js-bao-wss-client_api_interfaces_offlineauthfailedevent.md\":\"C7OWCUBX\",\"reference_js-bao-wss-client_api_interfaces_offlineauthrenewedevent.md\":\"C_JKp7J8\",\"reference_js-bao-wss-client_api_interfaces_offlineauthunlockedevent.md\":\"DebTeBwc\",\"reference_js-bao-wss-client_api_interfaces_pendingcreatecommittedevent.md\":\"COqt1UEB\",\"reference_js-bao-wss-client_api_interfaces_pendingcreatefailedevent.md\":\"C5JAWoGO\",\"reference_js-bao-wss-client_api_interfaces_permissionevent.md\":\"DsheyrQ7\",\"reference_js-bao-wss-client_api_interfaces_reasoningoptions.md\":\"C-q3_V1h\",\"reference_js-bao-wss-client_api_interfaces_sessioninfo.md\":\"DEF0Mbs0\",\"reference_js-bao-wss-client_api_interfaces_statuschangedevent.md\":\"Ch38giAk\",\"reference_js-bao-wss-client_api_interfaces_userprofile.md\":\"CvtyVxCI\",\"reference_js-bao-wss-client_api_readme.md\":\"ChRTWbJP\",\"reference_js-bao-wss-client_api_type-aliases_geminicontentpart.md\":\"B3A0mBhN\",\"reference_js-bao-wss-client_api_type-aliases_geminigenerateoptions.md\":\"291y8hpN\",\"reference_js-bao-wss-client_api_type-aliases_geminirole.md\":\"BGxIxe2b\",\"reference_js-bao-wss-client_api_type-aliases_jsbaoerrorcode.md\":\"BkEjPUE_\",\"reference_js-bao-wss-client_api_type-aliases_typedmodelconstructor.md\":\"BapSe7gt\",\"reference_js-bao-wss-client_api_variables_initjsbao.md\":\"BElJs0Jt\",\"reference_js-bao_api__media_model-autogen-plan.md\":\"DfdJCNXG\",\"reference_js-bao_api__media_model-migration-guide.md\":\"B0alswSY\",\"reference_js-bao_api_classes_basemodel.md\":\"By-6vDSb\",\"reference_js-bao_api_classes_databaseengine.md\":\"DZmwNBjW\",\"reference_js-bao_api_classes_documentclosederror.md\":\"ce8Dlw3L\",\"reference_js-bao_api_classes_documentresolutionerror.md\":\"C1yY2MvB\",\"reference_js-bao_api_classes_logger.md\":\"BH7ncJIo\",\"reference_js-bao_api_classes_modelregistry.md\":\"BUjRsen2\",\"reference_js-bao_api_classes_recordnotfounderror.md\":\"BSbYxNAn\",\"reference_js-bao_api_classes_stringset.md\":\"DwOzcDan\",\"reference_js-bao_api_classes_uniqueconstraintviolationerror.md\":\"BWvnk2xI\",\"reference_js-bao_api_enumerations_loglevel.md\":\"DY2lgutc\",\"reference_js-bao_api_functions_attachandregistermodel.md\":\"B_jNS89u\",\"reference_js-bao_api_functions_attachschematoclass.md\":\"BbPgv1vS\",\"reference_js-bao_api_functions_autoregistermodel.md\":\"OM6BPw2G\",\"reference_js-bao_api_functions_createmodelclass.md\":\"0axDu-0f\",\"reference_js-bao_api_functions_definemodelschema.md\":\"C3cxyUOI\",\"reference_js-bao_api_functions_dumpydoctoplain.md\":\"BCgeC1cl\",\"reference_js-bao_api_functions_field.md\":\"DrzEAwll\",\"reference_js-bao_api_functions_generateulid.md\":\"DL2fKE_D\",\"reference_js-bao_api_functions_initjsbao.md\":\"BDdO2wS1\",\"reference_js-bao_api_functions_model.md\":\"y_kl_cO8\",\"reference_js-bao_api_functions_resetjsbao.md\":\"D8VfImOI\",\"reference_js-bao_api_functions_summarizeplainydoc.md\":\"6jhclyY-\",\"reference_js-bao_api_globals.md\":\"BSTfQv8u\",\"reference_js-bao_api_interfaces_connecteddocument.md\":\"BJK-7otl\",\"reference_js-bao_api_interfaces_databaseconfig.md\":\"CkW7ezy6\",\"reference_js-bao_api_interfaces_documentconnectionevent.md\":\"D7UhUuCN\",\"reference_js-bao_api_interfaces_documentmanager.md\":\"BA7os4j3\",\"reference_js-bao_api_interfaces_dumpoptions.md\":\"DduHJ437\",\"reference_js-bao_api_interfaces_dumpsummary.md\":\"YViE6MrF\",\"reference_js-bao_api_interfaces_dumpsummaryentry.md\":\"B5xwOHoD\",\"reference_js-bao_api_interfaces_fieldoptions.md\":\"DzcrxL6_\",\"reference_js-bao_api_interfaces_initjsbaooptions.md\":\"BIj-7zPz\",\"reference_js-bao_api_interfaces_initjsbaoresult.md\":\"9SXDxzwj\",\"reference_js-bao_api_interfaces_modeloptions.md\":\"BUsTFjhB\",\"reference_js-bao_api_interfaces_paginatedresult.md\":\"FrIQs2d5\",\"reference_js-bao_api_interfaces_paginationoptions.md\":\"iGji9EAM\",\"reference_js-bao_api_interfaces_queryoptions.md\":\"BuRYFjXZ\",\"reference_js-bao_api_interfaces_saveoptions.md\":\"BNF7BL8A\",\"reference_js-bao_api_readme.md\":\"BgbSb-Rd\",\"reference_js-bao_api_type-aliases_documentconnectioncallback.md\":\"D2SSr3uJ\",\"reference_js-bao_api_type-aliases_documentfilter.md\":\"B8Hk8_Gg\",\"reference_js-bao_api_type-aliases_documentpermissionhint.md\":\"CJ9pX5sv\",\"reference_js-bao_api_type-aliases_inferattrs.md\":\"ZhYLZSnJ\",\"reference_js-bao_api_type-aliases_modelconstructor.md\":\"BfsqeY9E\",\"reference_js-bao_api_type-aliases_plainydoc.md\":\"B_MoPlIK\",\"reference_js-bao_api_type-aliases_projectionspec.md\":\"Bz5pKPiS\",\"reference_js-bao_api_type-aliases_queryresult.md\":\"CTc6XZNz\",\"reference_primitive-app_components_components_auth_primitivelogin.md\":\"DJKNCrj3\",\"reference_primitive-app_components_components_auth_primitivelogout.md\":\"CQ6eS4qP\",\"reference_primitive-app_components_components_auth_primitiveoauthcallback.md\":\"BcQ4aXC1\",\"reference_primitive-app_components_components_documents_primitivemanagedocuments.md\":\"CBUsysRG\",\"reference_primitive-app_components_components_documents_primitivesharedocumentdialog.md\":\"CnlEF_hL\",\"reference_primitive-app_components_components_documents_primitivesingledocumentswitcher.md\":\"DiIDBXwX\",\"reference_primitive-app_components_components_navigation_primitiveappbreadcrumb.md\":\"CtSggoOA\",\"reference_primitive-app_components_components_navigation_primitiveappsidebarheader.md\":\"CJbScXPK\",\"reference_primitive-app_components_components_navigation_primitivebottomnav.md\":\"HgfGSAbd\",\"reference_primitive-app_components_components_navigation_primitivenavigationbadge.md\":\"8eKsGKO-\",\"reference_primitive-app_components_components_navigation_primitivesidebarnav.md\":\"BUV8PgxK\",\"reference_primitive-app_components_components_navigation_primitiveusermenu.md\":\"BIoPEFns\",\"reference_primitive-app_components_components_shared_deleteconfirmationdialog.md\":\"BvOzIT18\",\"reference_primitive-app_components_components_shared_primitivelogospinner.md\":\"7bZQ7RC2\",\"reference_primitive-app_components_components_shared_primitiveskeletongate.md\":\"nN1U-jaY\",\"reference_primitive-app_components_layouts_primitiveapplayout.md\":\"BbQOr8A2\",\"reference_primitive-app_components_layouts_primitiveloginlayout.md\":\"Dk9WUG5g\",\"reference_primitive-app_components_layouts_primitivestaticlayout.md\":\"Do3hO_yu\",\"reference_primitive-app_components_pages_primitivenotfound.md\":\"D3Zq772V\",\"reference_primitive-app_components_primitivenotfound.md\":\"CxbGHin1\",\"reference_primitive-app_composables_usejsbaodataloader.md\":\"hvH3yANQ\",\"reference_primitive-app_composables_usetheme.md\":\"BiPtlAn2\",\"reference_primitive-app_config_app-config.md\":\"DOuNxk8B\",\"reference_primitive-app_config_env-config.md\":\"BUYDpzeT\",\"reference_primitive-app_config_index.md\":\"BMXYIbB9\",\"reference_primitive-app_config_navigation-config.md\":\"DoyYaPqj\",\"reference_primitive-app_createprimitiveapp.md\":\"EeIoaxes\",\"reference_primitive-app_types_app.md\":\"B1QCfMEK\",\"reference_primitive-app_types_js-bao-stub.d.md\":\"pakEqu84\",\"reference_primitive-app_types_navigation.md\":\"BxH8csKR\",\"reference_primitive-app_types_router.md\":\"D4YjcnBT\",\"reference_primitive-app_types_symbols_badgeconfig.md\":\"BPMX8rjF\",\"reference_primitive-app_types_symbols_badgevariant.md\":\"xkLo8Q35\",\"reference_primitive-app_types_symbols_bottomnavitem.md\":\"uYYEvyJP\",\"reference_primitive-app_types_symbols_breadcrumbsegment.md\":\"BEaE8TFL\",\"reference_primitive-app_types_symbols_definedmodelschema.md\":\"CXIQryLS\",\"reference_primitive-app_types_symbols_documentstoremode.md\":\"CgCR1fcb\",\"reference_primitive-app_types_symbols_index.md\":\"DKsYXxNN\",\"reference_primitive-app_types_symbols_inferattrs.md\":\"BJVV3lym\",\"reference_primitive-app_types_symbols_navigationconfig.md\":\"Cx-5qk5H\",\"reference_primitive-app_types_symbols_navigationitemsconfig.md\":\"DJ7yXWly\",\"reference_primitive-app_types_symbols_navigationoptions.md\":\"B0F7IUvs\",\"reference_primitive-app_types_symbols_navigationoverflowmode.md\":\"Dla8O88n\",\"reference_primitive-app_types_symbols_navitemconfig.md\":\"BeXegmK7\",\"reference_primitive-app_types_symbols_navitemimpl.md\":\"BNE0LLG0\",\"reference_primitive-app_types_symbols_registeredmodelinfo.md\":\"2f1Ice_-\",\"reference_primitive-app_utils_logger.md\":\"BFezxNxW\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"en-US\",\"dir\":\"ltr\",\"title\":\"Primitive Docs\",\"description\":\"Unified documentation for Primitive Labs libraries and apps.\",\"base\":\"/primitive-docs/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":true,\"themeConfig\":{\"search\":{\"provider\":\"local\"},\"nav\":[{\"text\":\"Docs\",\"link\":\"/\"}],\"sidebar\":[{\"text\":\"Getting Started\",\"items\":[{\"text\":\"Page 1\",\"link\":\"/getting-started/page-1\"},{\"text\":\"Page 2\",\"link\":\"/getting-started/page-2\"}],\"collapsible\":true,\"collapsed\":false},{\"text\":\"Reference\",\"items\":[{\"text\":\"primitive-app\",\"items\":[{\"text\":\"createPrimitiveApp\",\"link\":\"/reference/primitive-app/createPrimitiveApp\"},{\"text\":\"Components\",\"items\":[{\"text\":\"Auth\",\"items\":[{\"text\":\"PrimitiveLogin\",\"link\":\"/reference/primitive-app/components/components/auth/PrimitiveLogin\"},{\"text\":\"PrimitiveLogout\",\"link\":\"/reference/primitive-app/components/components/auth/PrimitiveLogout\"},{\"text\":\"PrimitiveOauthCallback\",\"link\":\"/reference/primitive-app/components/components/auth/PrimitiveOauthCallback\"}]},{\"text\":\"Documents\",\"items\":[{\"text\":\"PrimitiveManageDocuments\",\"link\":\"/reference/primitive-app/components/components/documents/PrimitiveManageDocuments\"},{\"text\":\"PrimitiveShareDocumentDialog\",\"link\":\"/reference/primitive-app/components/components/documents/PrimitiveShareDocumentDialog\"},{\"text\":\"PrimitiveSingleDocumentSwitcher\",\"link\":\"/reference/primitive-app/components/components/documents/PrimitiveSingleDocumentSwitcher\"}]},{\"text\":\"Navigation\",\"items\":[{\"text\":\"PrimitiveAppBreadcrumb\",\"link\":\"/reference/primitive-app/components/components/navigation/PrimitiveAppBreadcrumb\"},{\"text\":\"PrimitiveAppSidebarHeader\",\"link\":\"/reference/primitive-app/components/components/navigation/PrimitiveAppSidebarHeader\"},{\"text\":\"PrimitiveBottomNav\",\"link\":\"/reference/primitive-app/components/components/navigation/PrimitiveBottomNav\"},{\"text\":\"PrimitiveNavigationBadge\",\"link\":\"/reference/primitive-app/components/components/navigation/PrimitiveNavigationBadge\"},{\"text\":\"PrimitiveSidebarNav\",\"link\":\"/reference/primitive-app/components/components/navigation/PrimitiveSidebarNav\"},{\"text\":\"PrimitiveUserMenu\",\"link\":\"/reference/primitive-app/components/components/navigation/PrimitiveUserMenu\"}]},{\"text\":\"Shared\",\"items\":[{\"text\":\"DeleteConfirmationDialog\",\"link\":\"/reference/primitive-app/components/components/shared/DeleteConfirmationDialog\"},{\"text\":\"PrimitiveLogoSpinner\",\"link\":\"/reference/primitive-app/components/components/shared/PrimitiveLogoSpinner\"},{\"text\":\"PrimitiveSkeletonGate\",\"link\":\"/reference/primitive-app/components/components/shared/PrimitiveSkeletonGate\"}]}],\"collapsible\":true,\"collapsed\":true},{\"text\":\"Layouts\",\"items\":[{\"text\":\"PrimitiveAppLayout\",\"link\":\"/reference/primitive-app/components/layouts/PrimitiveAppLayout\"},{\"text\":\"PrimitiveLoginLayout\",\"link\":\"/reference/primitive-app/components/layouts/PrimitiveLoginLayout\"},{\"text\":\"PrimitiveStaticLayout\",\"link\":\"/reference/primitive-app/components/layouts/PrimitiveStaticLayout\"}],\"collapsible\":true,\"collapsed\":true},{\"text\":\"Pages\",\"items\":[{\"text\":\"PrimitiveNotFound\",\"link\":\"/reference/primitive-app/components/pages/PrimitiveNotFound\"}],\"collapsible\":true,\"collapsed\":true},{\"text\":\"Utils\",\"items\":[{\"text\":\"Logger\",\"link\":\"/reference/primitive-app/utils/Logger\"}],\"collapsible\":true,\"collapsed\":true},{\"text\":\"Composables\",\"items\":[{\"text\":\"useJsBaoDataLoader\",\"link\":\"/reference/primitive-app/composables/useJsBaoDataLoader\"},{\"text\":\"useTheme\",\"link\":\"/reference/primitive-app/composables/useTheme\"}],\"collapsible\":true,\"collapsed\":true},{\"text\":\"Config\",\"items\":[{\"text\":\"app-config\",\"link\":\"/reference/primitive-app/config/app-config\"},{\"text\":\"env-config\",\"link\":\"/reference/primitive-app/config/env-config\"},{\"text\":\"index\",\"link\":\"/reference/primitive-app/config/index\"},{\"text\":\"navigation-config\",\"link\":\"/reference/primitive-app/config/navigation-config\"}],\"collapsible\":true,\"collapsed\":true}],\"collapsible\":true,\"collapsed\":true},{\"text\":\"js-bao-wss-client\",\"items\":[{\"text\":\"Classes\",\"items\":[{\"text\":\"JsBaoClient\",\"link\":\"/reference/js-bao-wss-client/api/classes/JsBaoClient\"},{\"text\":\"JsBaoError\",\"link\":\"/reference/js-bao-wss-client/api/classes/JsBaoError\"}],\"collapsible\":true,\"collapsed\":true},{\"text\":\"Functions\",\"items\":[{\"text\":\"initializeClient\",\"link\":\"/reference/js-bao-wss-client/api/functions/initializeClient\"},{\"text\":\"isJsBaoError\",\"link\":\"/reference/js-bao-wss-client/api/functions/isJsBaoError\"}],\"collapsible\":true,\"collapsed\":true},{\"text\":\"Interfaces\",\"items\":[{\"text\":\"AnalyticsAutoEventsOptions\",\"link\":\"/reference/js-bao-wss-client/api/interfaces/AnalyticsAutoEventsOptions\"},{\"text\":\"AnalyticsClient\",\"link\":\"/reference/js-bao-wss-client/api/interfaces/AnalyticsClient\"},{\"text\":\"AnalyticsEventInput\",\"link\":\"/reference/js-bao-wss-client/api/interfaces/AnalyticsEventInput\"},{\"text\":\"AuthStateEvent\",\"link\":\"/reference/js-bao-wss-client/api/interfaces/AuthStateEvent\"},{\"text\":\"BasicUserInfo\",\"link\":\"/reference/js-bao-wss-client/api/interfaces/BasicUserInfo\"},{\"text\":\"BlobUploadCompletedEvent\",\"link\":\"/reference/js-bao-wss-client/api/interfaces/BlobUploadCompletedEvent\"},{\"text\":\"BlobUploadFailedEvent\",\"link\":\"/reference/js-bao-wss-client/api/interfaces/BlobUploadFailedEvent\"},{\"text\":\"BlobUploadProgressEvent\",\"link\":\"/reference/js-bao-wss-client/api/interfaces/BlobUploadProgressEvent\"},{\"text\":\"CacheFacade\",\"link\":\"/reference/js-bao-wss-client/api/interfaces/CacheFacade\"},{\"text\":\"DocumentAccessResult\",\"link\":\"/reference/js-bao-wss-client/api/interfaces/DocumentAccessResult\"},{\"text\":\"DocumentCreateCommitFailedEvent\",\"link\":\"/reference/js-bao-wss-client/api/interfaces/DocumentCreateCommitFailedEvent\"},{\"text\":\"DocumentEvent\",\"link\":\"/reference/js-bao-wss-client/api/interfaces/DocumentEvent\"},{\"text\":\"DocumentInfo\",\"link\":\"/reference/js-bao-wss-client/api/interfaces/DocumentInfo\"},{\"text\":\"DocumentInvitation\",\"link\":\"/reference/js-bao-wss-client/api/interfaces/DocumentInvitation\"},{\"text\":\"DocumentInvitationResponse\",\"link\":\"/reference/js-bao-wss-client/api/interfaces/DocumentInvitationResponse\"},{\"text\":\"DocumentMetadataChangedEvent\",\"link\":\"/reference/js-bao-wss-client/api/interfaces/DocumentMetadataChangedEvent\"},{\"text\":\"DocumentPermissionEntry\",\"link\":\"/reference/js-bao-wss-client/api/interfaces/DocumentPermissionEntry\"},{\"text\":\"GeminiGenerateRawOptions\",\"link\":\"/reference/js-bao-wss-client/api/interfaces/GeminiGenerateRawOptions\"},{\"text\":\"GeminiGenerateResult\",\"link\":\"/reference/js-bao-wss-client/api/interfaces/GeminiGenerateResult\"},{\"text\":\"GeminiMessage\",\"link\":\"/reference/js-bao-wss-client/api/interfaces/GeminiMessage\"},{\"text\":\"GeminiModelSummary\",\"link\":\"/reference/js-bao-wss-client/api/interfaces/GeminiModelSummary\"},{\"text\":\"GeminiPromptOptions\",\"link\":\"/reference/js-bao-wss-client/api/interfaces/GeminiPromptOptions\"},{\"text\":\"GeminiStructuredOutput\",\"link\":\"/reference/js-bao-wss-client/api/interfaces/GeminiStructuredOutput\"},{\"text\":\"IntegrationCallRequest\",\"link\":\"/reference/js-bao-wss-client/api/interfaces/IntegrationCallRequest\"},{\"text\":\"IntegrationCallResponse\",\"link\":\"/reference/js-bao-wss-client/api/interfaces/IntegrationCallResponse\"},{\"text\":\"IntegrationsAPI\",\"link\":\"/reference/js-bao-wss-client/api/interfaces/IntegrationsAPI\"},{\"text\":\"InvitationEvent\",\"link\":\"/reference/js-bao-wss-client/api/interfaces/InvitationEvent\"},{\"text\":\"JsBaoClientOptions\",\"link\":\"/reference/js-bao-wss-client/api/interfaces/JsBaoClientOptions\"},{\"text\":\"JsBaoEvents\",\"link\":\"/reference/js-bao-wss-client/api/interfaces/JsBaoEvents\"},{\"text\":\"LlmChatOptions\",\"link\":\"/reference/js-bao-wss-client/api/interfaces/LlmChatOptions\"},{\"text\":\"MeUpdatedEvent\",\"link\":\"/reference/js-bao-wss-client/api/interfaces/MeUpdatedEvent\"},{\"text\":\"MeUpdateFailedEvent\",\"link\":\"/reference/js-bao-wss-client/api/interfaces/MeUpdateFailedEvent\"},{\"text\":\"NetworkModeEvent\",\"link\":\"/reference/js-bao-wss-client/api/interfaces/NetworkModeEvent\"},{\"text\":\"OfflineAuthEnabledEvent\",\"link\":\"/reference/js-bao-wss-client/api/interfaces/OfflineAuthEnabledEvent\"},{\"text\":\"OfflineAuthExpiringSoonEvent\",\"link\":\"/reference/js-bao-wss-client/api/interfaces/OfflineAuthExpiringSoonEvent\"},{\"text\":\"OfflineAuthFailedEvent\",\"link\":\"/reference/js-bao-wss-client/api/interfaces/OfflineAuthFailedEvent\"},{\"text\":\"OfflineAuthRenewedEvent\",\"link\":\"/reference/js-bao-wss-client/api/interfaces/OfflineAuthRenewedEvent\"},{\"text\":\"OfflineAuthUnlockedEvent\",\"link\":\"/reference/js-bao-wss-client/api/interfaces/OfflineAuthUnlockedEvent\"},{\"text\":\"PendingCreateCommittedEvent\",\"link\":\"/reference/js-bao-wss-client/api/interfaces/PendingCreateCommittedEvent\"},{\"text\":\"PendingCreateFailedEvent\",\"link\":\"/reference/js-bao-wss-client/api/interfaces/PendingCreateFailedEvent\"},{\"text\":\"PermissionEvent\",\"link\":\"/reference/js-bao-wss-client/api/interfaces/PermissionEvent\"},{\"text\":\"ReasoningOptions\",\"link\":\"/reference/js-bao-wss-client/api/interfaces/ReasoningOptions\"},{\"text\":\"SessionInfo\",\"link\":\"/reference/js-bao-wss-client/api/interfaces/SessionInfo\"},{\"text\":\"StatusChangedEvent\",\"link\":\"/reference/js-bao-wss-client/api/interfaces/StatusChangedEvent\"},{\"text\":\"UserProfile\",\"link\":\"/reference/js-bao-wss-client/api/interfaces/UserProfile\"}],\"collapsible\":true,\"collapsed\":true},{\"text\":\"Type Aliases\",\"items\":[{\"text\":\"GeminiContentPart\",\"link\":\"/reference/js-bao-wss-client/api/type-aliases/GeminiContentPart\"},{\"text\":\"GeminiGenerateOptions\",\"link\":\"/reference/js-bao-wss-client/api/type-aliases/GeminiGenerateOptions\"},{\"text\":\"GeminiRole\",\"link\":\"/reference/js-bao-wss-client/api/type-aliases/GeminiRole\"},{\"text\":\"JsBaoErrorCode\",\"link\":\"/reference/js-bao-wss-client/api/type-aliases/JsBaoErrorCode\"},{\"text\":\"TypedModelConstructor\",\"link\":\"/reference/js-bao-wss-client/api/type-aliases/TypedModelConstructor\"}],\"collapsible\":true,\"collapsed\":true}],\"collapsible\":true,\"collapsed\":true},{\"text\":\"js-bao\",\"items\":[{\"text\":\"Classes\",\"items\":[{\"text\":\"BaseModel\",\"link\":\"/reference/js-bao/api/classes/BaseModel\"},{\"text\":\"DatabaseEngine\",\"link\":\"/reference/js-bao/api/classes/DatabaseEngine\"},{\"text\":\"DocumentClosedError\",\"link\":\"/reference/js-bao/api/classes/DocumentClosedError\"},{\"text\":\"DocumentResolutionError\",\"link\":\"/reference/js-bao/api/classes/DocumentResolutionError\"},{\"text\":\"Logger\",\"link\":\"/reference/js-bao/api/classes/Logger\"},{\"text\":\"ModelRegistry\",\"link\":\"/reference/js-bao/api/classes/ModelRegistry\"},{\"text\":\"RecordNotFoundError\",\"link\":\"/reference/js-bao/api/classes/RecordNotFoundError\"},{\"text\":\"StringSet\",\"link\":\"/reference/js-bao/api/classes/StringSet\"},{\"text\":\"UniqueConstraintViolationError\",\"link\":\"/reference/js-bao/api/classes/UniqueConstraintViolationError\"}],\"collapsible\":true,\"collapsed\":true},{\"text\":\"Functions\",\"items\":[{\"text\":\"attachAndRegisterModel\",\"link\":\"/reference/js-bao/api/functions/attachAndRegisterModel\"},{\"text\":\"attachSchemaToClass\",\"link\":\"/reference/js-bao/api/functions/attachSchemaToClass\"},{\"text\":\"autoRegisterModel\",\"link\":\"/reference/js-bao/api/functions/autoRegisterModel\"},{\"text\":\"createModelClass\",\"link\":\"/reference/js-bao/api/functions/createModelClass\"},{\"text\":\"defineModelSchema\",\"link\":\"/reference/js-bao/api/functions/defineModelSchema\"},{\"text\":\"dumpYDocToPlain\",\"link\":\"/reference/js-bao/api/functions/dumpYDocToPlain\"},{\"text\":\"Field\",\"link\":\"/reference/js-bao/api/functions/Field\"},{\"text\":\"generateULID\",\"link\":\"/reference/js-bao/api/functions/generateULID\"},{\"text\":\"initJsBao\",\"link\":\"/reference/js-bao/api/functions/initJsBao\"},{\"text\":\"Model\",\"link\":\"/reference/js-bao/api/functions/Model\"},{\"text\":\"resetJsBao\",\"link\":\"/reference/js-bao/api/functions/resetJsBao\"},{\"text\":\"summarizePlainYDoc\",\"link\":\"/reference/js-bao/api/functions/summarizePlainYDoc\"}],\"collapsible\":true,\"collapsed\":true},{\"text\":\"Interfaces\",\"items\":[{\"text\":\"ConnectedDocument\",\"link\":\"/reference/js-bao/api/interfaces/ConnectedDocument\"},{\"text\":\"DatabaseConfig\",\"link\":\"/reference/js-bao/api/interfaces/DatabaseConfig\"},{\"text\":\"DocumentConnectionEvent\",\"link\":\"/reference/js-bao/api/interfaces/DocumentConnectionEvent\"},{\"text\":\"DocumentManager\",\"link\":\"/reference/js-bao/api/interfaces/DocumentManager\"},{\"text\":\"DumpOptions\",\"link\":\"/reference/js-bao/api/interfaces/DumpOptions\"},{\"text\":\"DumpSummary\",\"link\":\"/reference/js-bao/api/interfaces/DumpSummary\"},{\"text\":\"DumpSummaryEntry\",\"link\":\"/reference/js-bao/api/interfaces/DumpSummaryEntry\"},{\"text\":\"FieldOptions\",\"link\":\"/reference/js-bao/api/interfaces/FieldOptions\"},{\"text\":\"InitJsBaoOptions\",\"link\":\"/reference/js-bao/api/interfaces/InitJsBaoOptions\"},{\"text\":\"InitJsBaoResult\",\"link\":\"/reference/js-bao/api/interfaces/InitJsBaoResult\"},{\"text\":\"ModelOptions\",\"link\":\"/reference/js-bao/api/interfaces/ModelOptions\"},{\"text\":\"PaginatedResult\",\"link\":\"/reference/js-bao/api/interfaces/PaginatedResult\"},{\"text\":\"PaginationOptions\",\"link\":\"/reference/js-bao/api/interfaces/PaginationOptions\"},{\"text\":\"QueryOptions\",\"link\":\"/reference/js-bao/api/interfaces/QueryOptions\"},{\"text\":\"SaveOptions\",\"link\":\"/reference/js-bao/api/interfaces/SaveOptions\"}],\"collapsible\":true,\"collapsed\":true},{\"text\":\"Type Aliases\",\"items\":[{\"text\":\"DocumentConnectionCallback\",\"link\":\"/reference/js-bao/api/type-aliases/DocumentConnectionCallback\"},{\"text\":\"DocumentFilter\",\"link\":\"/reference/js-bao/api/type-aliases/DocumentFilter\"},{\"text\":\"DocumentPermissionHint\",\"link\":\"/reference/js-bao/api/type-aliases/DocumentPermissionHint\"},{\"text\":\"InferAttrs\",\"link\":\"/reference/js-bao/api/type-aliases/InferAttrs\"},{\"text\":\"ModelConstructor\",\"link\":\"/reference/js-bao/api/type-aliases/ModelConstructor\"},{\"text\":\"PlainYDoc\",\"link\":\"/reference/js-bao/api/type-aliases/PlainYDoc\"},{\"text\":\"ProjectionSpec\",\"link\":\"/reference/js-bao/api/type-aliases/ProjectionSpec\"},{\"text\":\"QueryResult\",\"link\":\"/reference/js-bao/api/type-aliases/QueryResult\"}],\"collapsible\":true,\"collapsed\":true}],\"collapsible\":true,\"collapsed\":true}],\"collapsible\":true,\"collapsed\":true}],\"socialLinks\":[{\"icon\":\"github\",\"link\":\"https://github.com/Primitive-Labs/primitive-docs\"}]},\"locales\":{},\"scrollOffset\":134,\"cleanUrls\":false,\"additionalConfig\":{}}");</script>
    
  </body>
</html>